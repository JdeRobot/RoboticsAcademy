<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.16.5 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Pick and Place - Robotics-Academy</title>
<meta name="description" content="A practical and fun way of learning Robotics and Computer Vision">



<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Robotics-Academy">
<meta property="og:title" content="Pick and Place">
<meta property="og:url" content="http://localhost:4000/exercises/IndustrialRobots/pick_place">












  

  


<link rel="canonical" href="http://localhost:4000/exercises/IndustrialRobots/pick_place">







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "JdeRobot",
      "url": "http://localhost:4000",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Robotics-Academy Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="icon" type="image/png" href="/assets/images/logo.png" sizes="16x16">
<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/logo.png" alt=""></a>
        
        <a class="site-title" href="/">
          Robotics-Academy
          <span class="site-subtitle">by JdeRobot organization</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/exercises/" >Exercises</a>
            </li><li class="masthead__menu-item">
              <a href="/installation/" >Installation</a>
            </li><li class="masthead__menu-item">
              <a href="https://forum.jderobot.org/c/english/roboticsacademy" >Forum</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name"></h3>
    
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      <li>
        
          
          

          <a href="/exercises/"><span class="nav__sub-title">Exercises</span></a>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/exercises/autonomous_cars_section" class="">Autonomous Driving</a></li>
          
            
            

            
            

            <li><a href="/exercises/mobile_robots_section" class="">Service Robots</a></li>
          
            
            

            
            

            <li><a href="/exercises/drones_section" class="">Drones</a></li>
          
            
            

            
            

            <li><a href="/exercises/computer_vision_section" class="">Computer Vision</a></li>
          
            
            

            
            

            <li><a href="/exercises/industrial_robots_section" class="">Industrial Robots</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Contribute</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/roadmap/" class="">Roadmap</a></li>
          
            
            

            
            

            <li><a href="/contribute/" class="">How to contribute</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>
    
  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Pick and Place">
    
    
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Pick and Place
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-cog"></i> TOC Pick and Place</h4></header>
              <ul class="toc__menu">
  <li><a href="#installation">Installation</a></li>
  <li><a href="#how-to-run-the-exercise">How to run the exercise</a></li>
  <li><a href="#how-should-i-solve-the-exercise">How should I solve the exercise</a></li>
  <li><a href="#api">API</a>
    <ul>
      <li><a href="#environment-information">Environment Information</a></li>
      <li><a href="#convert-pose-message">Convert Pose Message</a></li>
      <li><a href="#basic-robot-movement">Basic Robot Movement</a></li>
      <li><a href="#setup-grasp-message">Setup Grasp message</a></li>
      <li><a href="#pick-and-place">Pick and Place</a></li>
    </ul>
  </li>
  <li><a href="#theory">Theory</a>
    <ul>
      <li><a href="#robot-workspace">Robot Workspace</a></li>
      <li><a href="#position-and-orientation">Position and Orientation</a></li>
      <li><a href="#forward-kinematics-and-inverse-kinematics">Forward Kinematics and Inverse Kinematics</a></li>
    </ul>
  </li>
  <li><a href="#hints">Hints</a>
    <ul>
      <li><a href="#relationship-among-ros-moveit-rviz-gazebo-jderobot-provided-api">Relationship among ROS, MoveIt, Rviz, Gazebo, JdeRobot provided API</a></li>
      <li><a href="#object-and-target-lists">Object and Target lists:</a></li>
      <li><a href="#why-does-the-robot-sometimes-cannot-move-to-some-desired-pose">Why does the robot sometimes cannot move to some desired pose?</a></li>
      <li><a href="#ignorable-error-and-warning">Ignorable ERROR and WARNING</a></li>
    </ul>
  </li>
  <li><a href="#demonstration-video-of-the-solution">Demonstration video of the solution</a></li>
</ul>
            </nav>
          </aside>
        
        <p>The goal of this exercise is to learn the underlying infrastructure of Industrial Robot exercises(ROS + MoveIt + our own industrial robotics API) and get familiar with the key components needed for more complex exercises by completing the task of pick and place multiple objects and classify them by color or shape.</p>

<figure class=" ">
  
    
      <a href="/assets/images/exercises/pick_place/pick_place_world.png" title="Pick and Place">
        <img src="/assets/images/exercises/pick_place/pick_place_world.png" alt="Pick and Place" />
      </a>
    
  
  
    <figcaption>Gallery.
</figcaption>
  
</figure>

<h2 id="installation">Installation</h2>
<ol>
  <li>Install the <a href="https://jderobot.github.io/RoboticsAcademy/installation/#generic-infrastructure">General Infrastructure</a> of the JdeRobot Robotics Academy.</li>
  <li>Install MoveIt
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt <span class="nb">install </span>ros-melodic-moveit
<span class="nb">sudo </span>apt-get <span class="nb">install </span>ros-melodic-ros-control ros-melodic-ros-controllers
</code></pre></div>    </div>
  </li>
  <li>Install Industrial Robot package
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> <span class="nt">-p</span> catkin_ws/src
<span class="nb">cd </span>catkin_ws/src
</code></pre></div>    </div>
    <p>after pull request to the industrial robot repo</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/JdeRobot/IndustrialRobots.git <span class="nt">-b</span> melodic_devel
<span class="nb">cd</span> ..
</code></pre></div>    </div>
    <p>Update ROS dependencies</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rosdep update
rosdep check <span class="nt">--from-paths</span> <span class="nb">.</span> <span class="nt">--ignore-src</span> <span class="nt">--rosdistro</span> melodic
rosdep <span class="nb">install</span> <span class="nt">--from-paths</span> <span class="nb">.</span> <span class="nt">--ignore-src</span> <span class="nt">--rosdistro</span> melodic <span class="nt">-y</span>
</code></pre></div>    </div>
    <p>Build workspace</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>catkin build
</code></pre></div>    </div>
    <p>Export environment variables</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s1">'source '</span><span class="nv">$PWD</span><span class="s1">'/devel/setup.bash'</span> <span class="o">&gt;&gt;</span> ~/.bashrc
<span class="nb">echo</span> <span class="s1">'export GAZEBO_MODEL_PATH=${GAZEBO_MODEL_PATH}:'</span><span class="nv">$PWD</span><span class="s1">'/src/IndustrialRobots/assets/models'</span> <span class="o">&gt;&gt;</span> ~/.bashrc
<span class="nb">source</span> ~/.bashrc
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="how-to-run-the-exercise">How to run the exercise</h2>
<p>To launch the exercise, open a terminal windows, navigate to <code class="language-plaintext highlighter-rouge">pick_place</code> folder inside <code class="language-plaintext highlighter-rouge">exercise</code> folder and execute following command:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>roslaunch pick_place.launch 
</code></pre></div></div>
<p>Two different windows will pop up:</p>
<ul>
  <li><strong>Gazebo simulator</strong>: A warehouse environment with a industrial robot(robot arm and gripper), multiple objects, a conveyor and two boxes will be shown in Gazebo.</li>
  <li><strong>Industrial robot teleoperator</strong>: A GUI which provides following functionalities:
    <ul>
      <li>A Forward Kinematics teleoperator providing sliders to change the angle of each joint of the robot arm and the gripper. The limits of each joints are shown in the two sides of the slider. The true angle of the joints are shown in the text box beside the sliders.</li>
      <li>An Inverse Kinematics teleoperator allowing users to set the desired end effector pose.
        <ul>
          <li>Plan button can plan the trajectory to the desired pose</li>
          <li>Execute button can make the robot execute the planned trajectory</li>
          <li>Plan &amp; Execute button is the integration of last two buttons</li>
          <li>Stop button allows users to stop the robot</li>
          <li>Back to home button can make the robot move back to home pose</li>
        </ul>
      </li>
      <li>Two update button can update the value of current robot state</li>
      <li>Code Manager part
        <ul>
          <li>Four buttons to start, stop, pause and restart the main code you program</li>
          <li>One button to launch Rviz</li>
          <li>One button to Respawn all objects in Gazebo and Rviz</li>
          <li>An info box showing the status of the main code(“start” or “stop”)</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<figure class=" ">
  
    
      <a href="/assets/images/exercises/pick_place/GUI.png" title="Robot Teleoperator">
        <img src="/assets/images/exercises/pick_place/GUI.png" alt="Robot Teleoperator" />
      </a>
    
  
  
    <figcaption>Robot teleoperator GUI
</figcaption>
  
</figure>

<p>Then open a new terminal window, navigate to <code class="language-plaintext highlighter-rouge">pick_place</code> folder inside <code class="language-plaintext highlighter-rouge">exercise</code> folder and execute following command:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python MyAlgorithm.py
</code></pre></div></div>
<p>You can start running the algorithm with the start button when you see <code class="language-plaintext highlighter-rouge">You can start your algorithm with GUI</code> in the terminal.</p>

<h2 id="how-should-i-solve-the-exercise">How should I solve the exercise</h2>
<p>To solve the exercise, you must edit the MyAlgorithm.py file and insert control logic in myalgorithm() function.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">myalgorithm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="c1">############## Insert your code here ###############
</span>    <span class="c1"># Move the robot back to home as a start
</span>    <span class="bp">self</span><span class="p">.</span><span class="n">pick_place</span><span class="p">.</span><span class="n">back_to_home</span><span class="p">()</span>
	
    <span class="c1"># insert following two lines where you want to pause or stop the algorithm 
</span>    <span class="c1"># with the stop button in GUI
</span>    <span class="k">while</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="p">.</span><span class="n">pauseevent</span><span class="p">.</span><span class="n">isSet</span><span class="p">())</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="p">.</span><span class="n">stopevent</span><span class="p">.</span><span class="n">isSet</span><span class="p">()):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">.</span><span class="n">stopevent</span><span class="p">.</span><span class="n">isSet</span><span class="p">():</span>
            <span class="k">return</span>

    <span class="c1">##### A brief example to pick and place object "blue_ball" #####
</span>    <span class="n">object_name</span> <span class="o">=</span> <span class="s">"blue_ball"</span>
    <span class="c1"># get object pose
</span>    <span class="n">pose</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">pick_place</span><span class="p">.</span><span class="n">get_object_pose</span><span class="p">(</span><span class="n">object_name</span><span class="p">)</span>

    <span class="c1"># generate grasp message and pick it up
</span>    <span class="c1"># parameters WIDTH and LENGTH need to be tuned according to the object and grasping pose
</span>    <span class="n">WIDTH</span> <span class="o">=</span> <span class="mf">0.3</span>
    <span class="n">LENGTH</span> <span class="o">=</span> <span class="mf">0.15</span>
    <span class="n">grasp</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">pick_place</span><span class="p">.</span><span class="n">generate_grasp</span><span class="p">(</span><span class="n">object_name</span><span class="p">,</span> <span class="s">"vertical"</span><span class="p">,</span> <span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">,</span> <span class="n">WIDTH</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="n">LENGTH</span><span class="p">)</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">pick_place</span><span class="p">.</span><span class="n">pickup</span><span class="p">(</span><span class="n">object_name</span><span class="p">,</span> <span class="p">[</span><span class="n">grasp</span><span class="p">])</span>

    <span class="c1"># setup stop signal detector
</span>    <span class="k">while</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="p">.</span><span class="n">pauseevent</span><span class="p">.</span><span class="n">isSet</span><span class="p">())</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="p">.</span><span class="n">stopevent</span><span class="p">.</span><span class="n">isSet</span><span class="p">()):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">.</span><span class="n">stopevent</span><span class="p">.</span><span class="n">isSet</span><span class="p">():</span>
            <span class="k">return</span>

    <span class="c1"># choose target position and place the object
</span>    <span class="n">target_name</span> <span class="o">=</span> <span class="s">"blue_target"</span>
    <span class="n">place_position</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">pick_place</span><span class="p">.</span><span class="n">get_target_position</span><span class="p">(</span><span class="n">target_name</span><span class="p">)</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">pick_place</span><span class="p">.</span><span class="n">place</span><span class="p">(</span><span class="s">"vertical"</span><span class="p">,</span> <span class="n">place_position</span><span class="p">)</span>

    <span class="c1">####################################################
</span>
</code></pre></div></div>
<p>Multiple APIs can be used to implement your algorithm. They are provided in Pick_Place class, so you should allways add “self.pick_place.” as a prefix to following introduced APIs in your algorithm.</p>

<h2 id="api">API</h2>
<h3 id="environment-information">Environment Information</h3>
<ul>
  <li><code class="language-plaintext highlighter-rouge">get_object_list()</code> - Return the name list of all objects.</li>
  <li><code class="language-plaintext highlighter-rouge">get_object_pose(object_name)</code> - Return the pose of the object.</li>
  <li><code class="language-plaintext highlighter-rouge">get_object_info(object_name)</code> - Return the pose, height, width, length, shape, color of the object in order.</li>
  <li><code class="language-plaintext highlighter-rouge">get_target_list()</code> - Return the name list of all targets.</li>
  <li><code class="language-plaintext highlighter-rouge">get_target_position(target_name)</code> - Return the position of target where we are going to place the objects.</li>
</ul>

<h3 id="convert-pose-message">Convert Pose Message</h3>
<ul>
  <li><code class="language-plaintext highlighter-rouge">pose2msg(roll, pitch, yaw, x, y, z)</code> - Convert pose to Pose message. The unit of roll, pitch, yaw is radian.</li>
  <li><code class="language-plaintext highlighter-rouge">pose2msg_deg(roll, pitch, yaw, x, y, z)</code> - Convert pose to Pose message. The unit of roll, pitch, yaw is degree.</li>
  <li><code class="language-plaintext highlighter-rouge">msg2pose(pose)</code> - Convert Pose message to pose, return roll, pitch, yaw, x, y, z in order. The unit of roll, pitch, yaw is radian.</li>
  <li><code class="language-plaintext highlighter-rouge">msg2pose_deg(pose)</code> - Convert Pose message to pose, return roll, pitch, yaw, x, y, z in order. The unit of roll, pitch, yaw is degree.</li>
</ul>

<h3 id="basic-robot-movement">Basic Robot Movement</h3>
<ul>
  <li><code class="language-plaintext highlighter-rouge">move_pose_arm(pose_goal)</code> - Command the robot with Pose message to make its end effector frame move to the desired pose with inverse kinematics.</li>
  <li><code class="language-plaintext highlighter-rouge">move_joint_arm(joint_0,joint_1,joint_2,joint_3,joint_4,joint_5)</code> - Command the robot joints to move to desired joints value</li>
  <li><code class="language-plaintext highlighter-rouge">move_joint_hand(joint_value)</code> - Command the gripper joint to move to desired joint value.</li>
  <li><code class="language-plaintext highlighter-rouge">back_to_home()</code> - Command the robot arm and gripper to move back to the home pose.</li>
</ul>

<h3 id="setup-grasp-message">Setup Grasp message</h3>
<p><a href="http://docs.ros.org/melodic/api/moveit_msgs/html/msg/Grasp.html">Grasp message</a> contains the informations that the MoveIt pick function requires.</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">generate_grasp(object_name, eef_orientation, position, [width, roll, pitch, yaw, length])</code> - Returns the specified Grasp message according to related setup.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">eef_orientaion</code> is to clarify the desired end effector orientation.
        <ul>
          <li><code class="language-plaintext highlighter-rouge">horizontal</code>: grasp the object with a horizontal gripper orientation. (default value: roll = pitch = yaw = 0. <code class="language-plaintext highlighter-rouge">pitch</code> is setable.)</li>
          <li><code class="language-plaintext highlighter-rouge">vertical</code>: grasp the object with a vertical gripper orientation. (default value: roll = 0, pitch = 90°, yaw = 0. <code class="language-plaintext highlighter-rouge">yaw</code> is setable.)</li>
          <li><code class="language-plaintext highlighter-rouge">user_defined</code>: grasp the object with a user defined gripper orientation. (default value: roll = pitch = yaw = 0. <code class="language-plaintext highlighter-rouge">roll</code>,<code class="language-plaintext highlighter-rouge">pitch</code>,<code class="language-plaintext highlighter-rouge">yaw</code> are all setable)</li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">position</code> is the position of the end effector when grasping the object</li>
      <li><code class="language-plaintext highlighter-rouge">width</code> is the value the gripper joints should move to grasp the object with a range of [0, 0.8]. If you keep the default value 0, the <code class="language-plaintext highlighter-rouge">eef_orientation</code> is <code class="language-plaintext highlighter-rouge">horizontal</code> or <code class="language-plaintext highlighter-rouge">vertical</code> and the default rpy angle values are kept, this width value will be set depend on the object width.</li>
      <li><code class="language-plaintext highlighter-rouge">roll</code>,<code class="language-plaintext highlighter-rouge">pitch</code>,<code class="language-plaintext highlighter-rouge">yaw</code> are optional parameters.</li>
      <li><code class="language-plaintext highlighter-rouge">length</code> is the offset length from the your desired gripper position to robot tool center. When you input grasping pose, you are specifying the pose of the desired gripper position. The default value is 0, which means you are specifying the pose of the tool center of the robot arm when the robot is grasping the object.</li>
    </ul>
  </li>
</ul>

<p>The default minimum grasp distance and desired distance are set to be 0.2(m) and 0.1(m). The default approach direction is set to be (0, 0, -0.5). You can keep them or modify them with following functions:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">set_grasp_distance(min_distance, desired_distance)</code> - Set the minimum distance and desired distance the gripper translates before and after grasping.</li>
  <li><code class="language-plaintext highlighter-rouge">set_grasp_direction(x, y, z)</code> - Set the direction of the gripper approach translation before grasping. Retreat translation distance will set to be the opposite direction of the approach direction.</li>
</ul>

<h3 id="pick-and-place">Pick and Place</h3>
<ul>
  <li><code class="language-plaintext highlighter-rouge">pickup(object_name, grasps)</code> - Command the industrial robot to pick up the object with a list of genrated Grasp messages.</li>
  <li><code class="language-plaintext highlighter-rouge">place(eef_orientation, position[, distance, roll, pitch, yaw])</code> - Command the industrial robot to place the currently holding object to goal_position with desired end effector orientation.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">eef_orientaion</code> is to clarify the desired end effector orientation.
        <ul>
          <li><code class="language-plaintext highlighter-rouge">horizontal</code>: grasp the object with a horizontal gripper orientation. (default value: roll = 0, pitch = 0, yaw = 180°. <code class="language-plaintext highlighter-rouge">pitch</code> is setable.)</li>
          <li><code class="language-plaintext highlighter-rouge">vertical</code>: grasp the object with a vertical gripper orientation. (default value: roll = 0, pitch = 90°, yaw = 180°. <code class="language-plaintext highlighter-rouge">yaw</code> is setable.)</li>
          <li><code class="language-plaintext highlighter-rouge">user_defined</code>: grasp the object with a user defined gripper orientation. (default value: roll = 0, pitch = 0, yaw = 180°. <code class="language-plaintext highlighter-rouge">roll</code>,<code class="language-plaintext highlighter-rouge">pitch</code>,<code class="language-plaintext highlighter-rouge">yaw</code> are all setable)</li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">position</code> is the position of the end effector when placing the object</li>
      <li><code class="language-plaintext highlighter-rouge">distance</code> is the distance the robot arm will move in z axis when placing objects. The default value is 0.1(m)</li>
    </ul>
  </li>
</ul>

<h2 id="theory">Theory</h2>

<h3 id="robot-workspace">Robot Workspace</h3>
<p>Workspace is the space the end effector of the robot can reach. It is limited by the mechanical structure of the robot. The industrial robot providers usually provide the workspace or work range for their robot in the manual. For example, the following image is the work range of irb120 robot, the robot we use in this exercise.</p>

<figure class=" ">
  
    
      <a href="/assets/images/exercises/pick_place/irb120_workspace.jpg" title="IRB120 Workspace">
        <img src="/assets/images/exercises/pick_place/irb120_workspace.jpg" alt="IRB120 Workspace" />
      </a>
    
  
  
    <figcaption>IRB120 Workspace
</figcaption>
  
</figure>

<p>When you are specifying the pose of the end effector to grasp or place the object, sometimes you will see a warning <code class="language-plaintext highlighter-rouge">***** GOAL POSE IS OUT OF ROBOT WORKSPACE *****</code> which is provided behind our API. However, as you can see, the workspace is complicated, so we only check whether the position is inside the outer sphere, outside of the inner sphere and above the bottom position. No warning doesn’t mean the position is inside the workspace.</p>

<p>Even if your specified position of the end effector is inside the workspace, if the orientation is not properly set, you are actually requiring other joints to move out of their workspaces.</p>

<h3 id="position-and-orientation">Position and Orientation</h3>
<p>In 3D space, a rigid body has six degrees of freedom. Its pose can be fully described by position, translations in three axis(x, y, z) from origin and orientation, rotation relative to reference frame. Position can be easily describe with (X, Y, Z) when coordinate frame is given. In our exercise, the reference frame is the robot frame with origin in its bottom center, x-axis pointing forward, y-axis pointing leftward and z-axis pointing upward.</p>

<p>By contrast, orientation is harder to describe. There are many different methods to describe orientation in 3D including rotation matrix, rotation vector, euler angle, quaternion. If you want to understand more about them and has linear algebra background, have a look of <a href="https://en.wikibooks.org/wiki/Robotics_Kinematics_and_Dynamics/Description_of_Position_and_Orientation">this page</a>. To finish this exercise, you only need to understand part of euler angle.</p>

<p>Roll, pitch, yaw are rotation angles around x, y, z axis. They are applied in order, such as x-y-z or z-y-x. Usually we use the new frame after each rotation as the new reference frame, but in <a href="http://wiki.ros.org/tf">tf</a>, a ROS library for managing coordinate frames, they choose static x-y-z euler angle as default method, which means each rotation will be applied with respect to(w.r.t.) the static original reference frame. Thus, in this exercise, roll, pitch, yaw will be applied in this x-y-z order w.r.t. the robot frame.</p>

<p>When you use the inverse kinematic tool in GUI, sometimes you will see that the input desired orientation is much different from the final orientation values, position also has tiny difference. The reason for the tiny difference is that when the difference between final pose and desired pose is within a given range, controller will stop. The reason for the large difference in orientation is that there are some other expressions that can also describe this orientation correctly.</p>

<figure class=" ">
  
    
      <a href="/assets/images/exercises/pick_place/rpy000.png" title="rpy000">
        <img src="/assets/images/exercises/pick_place/rpy000.png" alt="rpy000" />
      </a>
    
  
  
    <figcaption>roll = 0, pitch = 0, yaw = 0
</figcaption>
  
</figure>

<figure class="third ">
  
    
      <a href="/assets/images/exercises/pick_place/roll90.png" title="roll90">
        <img src="/assets/images/exercises/pick_place/roll90.png" alt="roll90" />
      </a>
    
  
    
      <a href="/assets/images/exercises/pick_place/pitch90.png" title="pitch90">
        <img src="/assets/images/exercises/pick_place/pitch90.png" alt="pitch90" />
      </a>
    
  
    
      <a href="/assets/images/exercises/pick_place/yaw90.png" title="yaw90">
        <img src="/assets/images/exercises/pick_place/yaw90.png" alt="yaw90" />
      </a>
    
  
  
    <figcaption>From left to right: roll, pitch, yaw = (90°, 0, 0), (0, 90°, 0), (0, 0, 90°)
</figcaption>
  
</figure>

<h3 id="forward-kinematics-and-inverse-kinematics">Forward Kinematics and Inverse Kinematics</h3>
<p>Forward kinematics is given the value of each joints, to find the pose of the end effector. The pose is unique.<br />
Inverse kinematics is given the pose of the end effector, to find possible joints value and trajectory to move from start state to goal state. There are usually multiple solutions.</p>

<h2 id="hints">Hints</h2>

<h3 id="relationship-among-ros-moveit-rviz-gazebo-jderobot-provided-api">Relationship among ROS, MoveIt, Rviz, Gazebo, JdeRobot provided API</h3>
<ul>
  <li><a href="https://www.ros.org/">ROS</a>(Robot Operating System) is a robotics middleware which contains a set of open source libraries for developing robot applications.</li>
  <li><a href="https://moveit.ros.org/">MoveIt</a> is an open source Motion Planning framework for industrial robot which integrates motion planning, collision checking, manipulation, 3D perception capabilities.</li>
  <li><a href="http://wiki.ros.org/rviz">Rviz</a> is a 3D visualization tool for ROS. Many ROS topics can be visualized in Rviz, including the planning scene of MoveIt move group, but it does not contain any physics simulation capability.</li>
  <li><a href="http://gazebosim.org/">Gazebo</a> is a physics simulator mainly use for robot simulation.</li>
  <li>The APIs provided by JdeRobot Academy are based on the above tools, so the user don’t need to learn all of them to start simulation of industrial robot manipulation.</li>
</ul>

<p><strong>Objects visualization</strong><br />
When we start Gazebo with a world file, the objects in Gazebo will not be automatically added in the planning scene of MoveIt, so we can only see the robot in Rviz without any other objects. If we want MoveIt to know there are some objects in the environment, we should manually add them into the planning scene, but you don’t need to worry about it in this exercise as it has been done by us.</p>

<p><strong>Obstacle Avoidance</strong><br />
After adding objects into planning scene, MoveIt will avoid planning trajectory for the robot that will lead to collision. However, because the object in planning scene cannot be updated automatically with their pose in Gazebo, after the robot grasping them, we cannot track their poses any more, so MoveIt cannot take them into consideration of obstacle avoidance.</p>

<p><strong>Pick and Place</strong><br />
Moveit provides pick and place functions. We can perform great pick and place in planning scene with them, but at the same time, you will see that the objects cannot be picked up in Gazebo. The reason for it is that Gazebo, as a physical simulator, still cannot simulate the contact between two surface perfectly. Even if we can see the robot pick up the object successfully in Rviz, it might not work in Gazebo.</p>

<h3 id="object-and-target-lists">Object and Target lists:</h3>
<p><strong>Object list:</strong></p>
<ul>
  <li>yellow_box</li>
  <li>red_box</li>
  <li>blue_box</li>
  <li>blue_ball</li>
  <li>yellow_ball</li>
  <li>green_ball</li>
  <li>green_cylinder</li>
  <li>red_cylinder</li>
</ul>

<p><strong>Target list:</strong></p>
<ul>
  <li>red_target</li>
  <li>green_target</li>
  <li>blue_target</li>
  <li>yellow_target</li>
</ul>

<h3 id="why-does-the-robot-sometimes-cannot-move-to-some-desired-pose">Why does the robot sometimes cannot move to some desired pose?</h3>
<p>The most possible reason is that your specified pose is unreachable for the robot arm, so MoveIt cannot plan a trajectory from current pose to desired pose in limited time. You will see such a warning when this problem happened:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Fail: ABORTED: No motion plan found. No execution attempted.
</code></pre></div></div>
<h3 id="ignorable-error-and-warning">Ignorable ERROR and WARNING</h3>
<ul>
  <li><code class="language-plaintext highlighter-rouge">No p gain specified for pid.</code></li>
  <li><code class="language-plaintext highlighter-rouge">Controller is taking too long to execute trajectory</code></li>
  <li><code class="language-plaintext highlighter-rouge">Controller failed with error GOAL_TOLERANCE_VIOLATED</code></li>
</ul>

<h2 id="demonstration-video-of-the-solution">Demonstration video of the solution</h2>

<div class="embed-container">
  <iframe src="https://www.youtube.com/embed/kJMPz80w9BM" width="700" height="480" frameborder="0" allowfullscreen="">
  </iframe>
</div>


        
      </section>

      <footer class="page__meta">
        
        


        
      </footer>

      

      
    </div>

    
  </article>

  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://twitter.com/jderobot" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/JdeRobot/RoboticsAcademy" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
          <li><a href="https://www.youtube.com/channel/UCgmUgpircYAv_QhLQziHJOQ" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-youtube" aria-hidden="true"></i> Youtube</a></li>
        
      
    

   <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2021 JdeRobot. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>


      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>
  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML">
  </script>
  <script type="text/x-mathjax-config">
     MathJax.Hub.Config({
       extensions: ["tex2jax.js"],
       jax: ["input/TeX", "output/HTML-CSS"],
       tex2jax: {
         inlineMath: [ ['$','$'], ["\\(","\\)"] ],
         displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
         processEscapes: true
       },
       "HTML-CSS": { availableFonts: ["TeX"] }
     });
  </script>










  </body>
</html>
