<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.16.5 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Follow Turtlebot - Robotics-Academy</title>
<meta name="description" content="A practical and fun way of learning Robotics and Computer Vision">



<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Robotics-Academy">
<meta property="og:title" content="Follow Turtlebot">
<meta property="og:url" content="http://localhost:4000/exercises/Drones/follow_turtlebot">












  

  


<link rel="canonical" href="http://localhost:4000/exercises/Drones/follow_turtlebot">







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "JdeRobot",
      "url": "http://localhost:4000",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Robotics-Academy Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="icon" type="image/png" href="/assets/images/logo.png" sizes="16x16">
<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/logo.png" alt=""></a>
        
        <a class="site-title" href="/">
          Robotics-Academy
          <span class="site-subtitle">by JdeRobot organization</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/exercises/" >Exercises</a>
            </li><li class="masthead__menu-item">
              <a href="/installation/" >Installation</a>
            </li><li class="masthead__menu-item">
              <a href="https://forum.jderobot.org/c/english/roboticsacademy" >Forum</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name"></h3>
    
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      <li>
        
          
          

          <a href="/exercises/"><span class="nav__sub-title">Exercises</span></a>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/exercises/autonomous_cars_section" class="">Autonomous Driving</a></li>
          
            
            

            
            

            <li><a href="/exercises/mobile_robots_section" class="">Service Robots</a></li>
          
            
            

            
            

            <li><a href="/exercises/drones_section" class="">Drones</a></li>
          
            
            

            
            

            <li><a href="/exercises/computer_vision_section" class="">Computer Vision</a></li>
          
            
            

            
            

            <li><a href="/exercises/industrial_robots_section" class="">Industrial Robots</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Contribute</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/roadmap/" class="">Roadmap</a></li>
          
            
            

            
            

            <li><a href="/contribute/" class="">How to contribute</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>
    
  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Follow Turtlebot">
    
    
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Follow Turtlebot
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-cog"></i> TOC Follow Turtlebot</h4></header>
              <ul class="toc__menu">
  <li><a href="#goal">Goal</a></li>
  <li><a href="#instructions-for-web-templates">Instructions for Web Templates</a>
    <ul>
      <li><a href="#installation">Installation</a></li>
      <li><a href="#enable-gpu-acceleration">Enable GPU Acceleration</a></li>
      <li><a href="#how-to-perform-the-exercise">How to perform the exercise?</a></li>
      <li><a href="#where-to-insert-the-code">Where to insert the code?</a></li>
      <li><a href="#using-the-interface">Using the Interface</a></li>
    </ul>
  </li>
  <li><a href="#application-programming-interface">Application Programming Interface</a>
    <ul>
      <li><a href="#sensors-and-drone-state">Sensors and drone state</a></li>
      <li><a href="#actuators-and-drone-control">Actuators and drone control</a>
        <ul>
          <li><a href="#1-position-control">1. Position control</a></li>
          <li><a href="#2-velocity-control">2. Velocity control</a></li>
          <li><a href="#3-mixed-control">3. Mixed control</a></li>
        </ul>
      </li>
      <li><a href="#drone-takeoff-and-land">Drone takeoff and land</a></li>
      <li><a href="#drone-cameras">Drone cameras</a></li>
      <li><a href="#gui">GUI</a></li>
    </ul>
  </li>
  <li><a href="#hints">Hints</a>
    <ul>
      <li><a href="#turtlebot-detection">TurtleBot Detection</a></li>
      <li><a href="#directional-control-how-should-drone-yaw-be-handled">Directional control. How should drone yaw be handled?</a></li>
      <li><a href="#do-i-need-to-know-when-the-drone-is-in-the-air">Do I need to know when the drone is in the air?</a></li>
    </ul>
  </li>
  <li><a href="#demonstrative-video-of-the-solution">Demonstrative video of the solution</a></li>
  <li><a href="#contributors">Contributors</a></li>
</ul>
            </nav>
          </aside>
        
        <h2 id="goal">Goal</h2>

<p>The goal of this exercise is to implement the logic that allows a quadrotor to follow a turtlebot on the ground by following the movements made by it.</p>

<figure class=" ">
  
    
      <a href="/assets/images/exercises/follow_turtlebot/follow_turtlebot.jpg" title="Follow Turtlebot.">
        <img src="/assets/images/exercises/follow_turtlebot/follow_turtlebot.jpg" alt="Follow Turtlebot." />
      </a>
    
  
  
    <figcaption>Gallery.
</figcaption>
  
</figure>

<h2 id="instructions-for-web-templates">Instructions for Web Templates</h2>
<p>This is the preferred way for running the exercise.</p>

<h3 id="installation">Installation</h3>

<ul>
  <li>
    <p>Download <a href="https://docs.docker.com/get-docker/">Docker</a>. Windows users should choose WSL 2 backend Docker installation if possible, as it has better performance than Hyper-V.</p>
  </li>
  <li>
    <p>Pull the current distribution of Robotics Academy Docker Image</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker pull jderobot/robotics-academy:3.1.3
</code></pre></div>    </div>
  </li>
  <li>
    <p>In order to obtain optimal performance, Docker should be using multiple CPU cores. In case of Docker for Mac or Docker for Windows, the VM should be assigned a greater number of cores.</p>
  </li>
</ul>

<h3 id="enable-gpu-acceleration">Enable GPU Acceleration</h3>
<ul>
  <li>For Linux machines with NVIDIA GPUs, acceleration can be enabled by using NVIDIA proprietary drivers, installing  <a href="https://virtualgl.org/">VirtualGL</a> and executing the following docker run command:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-it</span> <span class="nt">--rm</span> <span class="nt">--device</span> /dev/dri <span class="nt">-p</span> 8000:8000 <span class="nt">-p</span> 2303:2303 <span class="nt">-p</span> 1905:1905 <span class="nt">-p</span> 8765:8765 <span class="nt">-p</span> 6080:6080 <span class="nt">-p</span> 1108:1108 jderobot/robotics-academy:3.1.3 ./start-3.1.sh
</code></pre></div>    </div>
  </li>
  <li>For Windows machines, GPU acceleration to Docker is an experimental approach and can be implemented as per instructions given <a href="https://www.docker.com/blog/wsl-2-gpu-support-is-here/">here</a></li>
</ul>

<h3 id="how-to-perform-the-exercise">How to perform the exercise?</h3>
<ul>
  <li>
    <p>Start a new docker container of the image and keep it running in the background (<a href="#enable-gpu-acceleration">hardware accelerated version</a>)</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-it</span> <span class="nt">--rm</span> <span class="nt">-p</span> 8000:8000 <span class="nt">-p</span> 2303:2303 <span class="nt">-p</span> 1905:1905 <span class="nt">-p</span> 8765:8765 <span class="nt">-p</span> 6080:6080 <span class="nt">-p</span> 1108:1108 jderobot/robotics-academy:3.1.3 ./start-3.1.sh
</code></pre></div>    </div>
  </li>
  <li>
    <p>On the local machine navigate to 127.0.0.1:8000/ in the browser and choose the desired exercise.</p>
  </li>
  <li>
    <p>Click the connect button and wait for some time until an alert appears with the message <code class="language-plaintext highlighter-rouge">Connection Established</code> and button displays connected.</p>
  </li>
  <li>
    <p>The exercise can be used after the alert.</p>
  </li>
</ul>

<h3 id="where-to-insert-the-code">Where to insert the code?</h3>

<p>In the launched webpage, type your code in the text editor,</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">GUI</span> <span class="kn">import</span> <span class="n">GUI</span>
<span class="kn">from</span> <span class="nn">HAL</span> <span class="kn">import</span> <span class="n">HAL</span>
<span class="c1"># Enter sequential code!
</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="c1"># Enter iterative code!
</span></code></pre></div></div>

<h3 id="using-the-interface">Using the Interface</h3>

<ul>
  <li>
    <p><strong>Control Buttons</strong>: The control buttons enable the control of the interface. Play button sends the code written by User to the Robot. Stop button stops the code that is currently running on the Robot. Save button saves the code on the local machine. Load button loads the code from the local machine. Reset button resets the simulation(primarily, the position of the robot).</p>
  </li>
  <li>
    <p><strong>Frequency Slider</strong>: This slider adjusts the running frequency of the iterative part of the code(under the <code class="language-plaintext highlighter-rouge">while True:</code>). A smaller value implies the code runs less number of times. A higher value implies the code runs a large number of times. The Target Frequency is the one set on the Slider and Measured Frequency is the one measured by the computer(a frequency of execution the computer is able to maintain despite the commanded one). The student should adjust the Target Frequency according to the Measured Frequency.</p>
  </li>
  <li>
    <p><strong>Debug Level</strong>: This decides the debugging level of the code. A debug level of 1 implies no debugging at all. At this level, all the GUI functions written by the student are automatically removed when the student sends the code to the robot. A debug level greater than or equal to 2 enables all the GUI functions working properly.</p>
  </li>
  <li>
    <p><strong>Psuedo Console</strong>: This shows the error messages related to the student’s code that is sent. In order to print certain debugging information on this console. The student can use the <code class="language-plaintext highlighter-rouge">print()</code> command in the Editor.</p>
  </li>
</ul>

<h2 id="application-programming-interface">Application Programming Interface</h2>

<ul>
  <li><code class="language-plaintext highlighter-rouge">from HAL import HAL</code> - to import the HAL(Hardware Abstraction Layer) library class. This class contains the functions that sends and receives information to and from the Hardware(Gazebo).</li>
  <li><code class="language-plaintext highlighter-rouge">from GUI import GUI</code> - to import the GUI(Graphical User Interface) library class. This class contains the functions used to view the debugging information, like image widgets.</li>
</ul>

<h3 id="sensors-and-drone-state">Sensors and drone state</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">HAL.get_position()</code> - Returns the actual position of the drone as a numpy array [x, y, z], in m.</li>
  <li><code class="language-plaintext highlighter-rouge">HAL.get_velocity()</code> - Returns the actual velocities of the drone as a numpy array [vx, vy, vz], in m/s</li>
  <li><code class="language-plaintext highlighter-rouge">HAL.get_yaw_rate()</code> - Returns the actual yaw rate of the drone, in rad/s.</li>
  <li><code class="language-plaintext highlighter-rouge">HAL.get_orientation()</code> - Returns the actual roll, pitch and yaw of the drone as a numpy array [roll, pitch, yaw], in rad.</li>
  <li><code class="language-plaintext highlighter-rouge">HAL.get_roll()</code> - Returns the roll angle of the drone, in rad</li>
  <li><code class="language-plaintext highlighter-rouge">HAL.get_pitch()</code> - Returns the pitch angle of the drone, in rad.</li>
  <li><code class="language-plaintext highlighter-rouge">HAL.get_yaw()</code> - Returns the yaw angle of the drone, in rad.</li>
  <li><code class="language-plaintext highlighter-rouge">HAL.get_landed_state()</code> -  Returns 1 if the drone is on the ground (landed), 2 if the drone is in the air and 4 if the drone is landing. 0 could be also returned if the drone landed state is unknown.</li>
</ul>

<h3 id="actuators-and-drone-control">Actuators and drone control</h3>

<p>The three following drone control functions are <em>non-blocking</em>, i.e. each time you send a new command to the aircraft it immediately discards the previous control command.</p>

<h4 id="1-position-control">1. Position control</h4>

<ul>
  <li><code class="language-plaintext highlighter-rouge">HAL.set_cmd_pos(x, y, z, az)</code> - Commands the <em>position</em> (x,y,z) of the drone, in m and the <em>yaw angle (az)</em> (in rad) taking as reference the first takeoff point (map frame)</li>
</ul>

<h4 id="2-velocity-control">2. Velocity control</h4>

<ul>
  <li><code class="language-plaintext highlighter-rouge">HAL.set_cmd_vel(vx, vy, vz, az)</code> - Commands the <em>linear velocity</em> of the drone in the x, y and z directions (in m/s) and the <em>yaw rate (az)</em> (rad/s) in its body fixed frame</li>
</ul>

<h4 id="3-mixed-control">3. Mixed control</h4>

<ul>
  <li><code class="language-plaintext highlighter-rouge">HAL.set_cmd_mix(vx, vy, z, az)</code> - Commands the <em>linear velocity</em> of the drone in the x, y directions (in m/s), the <em>height</em> (z) related to the takeoff point and the <em>yaw rate (az)</em> (in rad/s)</li>
</ul>

<h3 id="drone-takeoff-and-land">Drone takeoff and land</h3>

<p>Besides using the buttons at the drone teleoperator GUI, taking off and landing can also be controlled from the following commands in your code:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">HAL.takeoff(height)</code> - Takeoff at the current location, to the given height (in m)</li>
  <li><code class="language-plaintext highlighter-rouge">HAL.land()</code> - Land at the current location.</li>
</ul>

<h3 id="drone-cameras">Drone cameras</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">HAL.get_frontal_image()</code> - Returns the latest image from the frontal camera as a OpenCV cv2_image</li>
  <li><code class="language-plaintext highlighter-rouge">HAL.get_ventral_image()</code> - Returns the latest image from the ventral camera as a OpenCV cv2_image</li>
</ul>

<h3 id="gui">GUI</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">GUI.showImage(cv2_image)</code> - Shows a image of the camera  in the GUI</li>
  <li><code class="language-plaintext highlighter-rouge">GUI.showLeftImage(cv2_image)</code> - Shows another image of the camera in the GUI</li>
</ul>

<!--## Theory
**Comming soon.**-->

<h2 id="hints">Hints</h2>

<p>Simple hints provided to help you solve the follow_turtlebot exercise. Please note that the <strong>full solution has not been provided.</strong></p>

<h3 id="turtlebot-detection">TurtleBot Detection</h3>

<p>Notice that the ground robot has a visual signal over it. You can filter this signal in order to follow the ground robot.</p>

<h3 id="directional-control-how-should-drone-yaw-be-handled">Directional control. How should drone yaw be handled?</h3>

<p>If you don’t take care of the drone yaw angle or yaw_rate in your code (keeping them always equal to zero), you will fly in what’s generally called <strong>Heads Free Mode</strong>. The drone will always face towards its initial orientation, and it will fly sideways or even backwards when commanded towards a target destination. Multi-rotors can easily do that, but what’s not the best way of flying a drone.</p>

<p>Another possibility is to use <strong>Nose Forward Mode</strong>, where the drone follows the path similar to a fixed-wing aircraft. Then, to accomplish it, you’ll have to implement by yourself some kind of directional control, to rotate the nose of your drone left or right using yaw angle, or yaw_rate.</p>

<p>In this exercise, you should use the Nose Forward Mode.</p>

<h3 id="do-i-need-to-know-when-the-drone-is-in-the-air">Do I need to know when the drone is in the air?</h3>

<p>No, you can solve this exercise without taking care of the <strong>land state</strong> of the drone. However, it could be a great enhancement to your blocking position control function if you make it only work when the drone is actually flying, not on the ground.</p>

<h2 id="demonstrative-video-of-the-solution">Demonstrative video of the solution</h2>

<div class="embed-container">
  <iframe src="https://www.youtube.com/embed/uehDVlBzpmU" width="700" height="480" frameborder="0" allowfullscreen="">
  </iframe>
</div>

<hr />

<h2 id="contributors">Contributors</h2>

<ul>
  <li>Contributors: <a href="https://github.com/nkhedekar">Nikhil Khedekar</a>, <a href="https://github.com/jmplaza">JoseMaria Cañas</a>, <a href="https://github.com/diegomrt">Diego Martín</a>, <a href="https://github.com/pariaspe">Pedro Arias</a> and <a href="https://github.com/iamarkaj">Arkajyoti Basak</a>.</li>
  <li>Maintained by <a href="https://github.com/pariaspe">Pedro Arias</a> and <a href="https://github.com/iamarkaj">Arkajyoti Basak</a>.</li>
</ul>

        
      </section>

      <footer class="page__meta">
        
        


        
      </footer>

      

      
    </div>

    
  </article>

  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://twitter.com/jderobot" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/JdeRobot/RoboticsAcademy" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
          <li><a href="https://www.youtube.com/channel/UCgmUgpircYAv_QhLQziHJOQ" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-youtube" aria-hidden="true"></i> Youtube</a></li>
        
      
    

   <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2021 JdeRobot. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>


      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>
  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML">
  </script>
  <script type="text/x-mathjax-config">
     MathJax.Hub.Config({
       extensions: ["tex2jax.js"],
       jax: ["input/TeX", "output/HTML-CSS"],
       tex2jax: {
         inlineMath: [ ['$','$'], ["\\(","\\)"] ],
         displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
         processEscapes: true
       },
       "HTML-CSS": { availableFonts: ["TeX"] }
     });
  </script>










  </body>
</html>
