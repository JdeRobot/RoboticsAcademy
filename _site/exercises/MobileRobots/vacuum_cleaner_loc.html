<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.16.5 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Localized Vacuum Cleaner - Robotics-Academy</title>
<meta name="description" content="A practical and fun way of learning Robotics and Computer Vision">



<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Robotics-Academy">
<meta property="og:title" content="Localized Vacuum Cleaner">
<meta property="og:url" content="http://localhost:4000/exercises/MobileRobots/vacuum_cleaner_loc">












  

  


<link rel="canonical" href="http://localhost:4000/exercises/MobileRobots/vacuum_cleaner_loc">







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "JdeRobot",
      "url": "http://localhost:4000",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Robotics-Academy Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="icon" type="image/png" href="/assets/images/logo.png" sizes="16x16">
<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/logo.png" alt=""></a>
        
        <a class="site-title" href="/">
          Robotics-Academy
          <span class="site-subtitle">by JdeRobot organization</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/exercises/" >Exercises</a>
            </li><li class="masthead__menu-item">
              <a href="/installation/" >Installation</a>
            </li><li class="masthead__menu-item">
              <a href="https://forum.jderobot.org/c/english/roboticsacademy" >Forum</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name"></h3>
    
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      <li>
        
          
          

          <a href="/exercises/"><span class="nav__sub-title">Exercises</span></a>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/exercises/autonomous_cars_section" class="">Autonomous Driving</a></li>
          
            
            

            
            

            <li><a href="/exercises/mobile_robots_section" class="">Service Robots</a></li>
          
            
            

            
            

            <li><a href="/exercises/drones_section" class="">Drones</a></li>
          
            
            

            
            

            <li><a href="/exercises/computer_vision_section" class="">Computer Vision</a></li>
          
            
            

            
            

            <li><a href="/exercises/industrial_robots_section" class="">Industrial Robots</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Contribute</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/roadmap/" class="">Roadmap</a></li>
          
            
            

            
            

            <li><a href="/contribute/" class="">How to contribute</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>
    
  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Localized Vacuum Cleaner">
    
    
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Localized Vacuum Cleaner
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-cog"></i> TOC Localized Vacuum Cleaner</h4></header>
              <ul class="toc__menu">
  <li><a href="#versions-to-run-the-exercise">Versions to run the exercise</a></li>
  <li><a href="#goal">Goal</a></li>
  <li><a href="#instructions-for-web-templates">Instructions for Web Templates</a>
    <ul>
      <li><a href="#installation">Installation</a></li>
      <li><a href="#enable-gpu-acceleration">Enable GPU Acceleration</a></li>
      <li><a href="#how-to-perform-the-exercise">How to perform the exercise?</a></li>
      <li><a href="#using-the-interface">Using the Interface</a></li>
    </ul>
  </li>
  <li><a href="#instructions-for-rosnode-templates">Instructions for ROSNode Templates</a>
    <ul>
      <li><a href="#installation-1">Installation</a></li>
      <li><a href="#how-to-run">How to run</a></li>
      <li><a href="#how-to-do-the-practice">How to do the practice</a></li>
    </ul>
  </li>
  <li><a href="#where-to-insert-the-code">Where to insert the code</a>
    <ul>
      <li><a href="#api">API</a></li>
      <li><a href="#types-conversion">Types conversion</a></li>
    </ul>
  </li>
  <li><a href="#demonstration-video">Demonstration video</a></li>
  <li><a href="#theory">Theory</a>
    <ul>
      <li><a href="#conversion-from-3d-to-2d">Conversion From 3D to 2D</a>
        <ul>
          <li><a href="#transformation-matrices">Transformation Matrices</a></li>
        </ul>
      </li>
      <li><a href="#coverage-and-decomposition">Coverage and Decomposition</a></li>
      <li><a href="#travelling-between-segments">Travelling between segments</a></li>
    </ul>
  </li>
  <li><a href="#hints">Hints</a>
    <ul>
      <li><a href="#grid-representation">Grid Representation</a></li>
      <li><a href="#obstacles-and-color-coding">Obstacles and Color Coding</a></li>
      <li><a href="#checking-for-points">Checking for Points</a></li>
    </ul>
  </li>
  <li><a href="#illustrations">Illustrations</a></li>
  <li><a href="#contributors">Contributors</a></li>
  <li><a href="#references">References</a></li>
</ul>
            </nav>
          </aside>
        
        <h2 id="versions-to-run-the-exercise">Versions to run the exercise</h2>

<p>Currently, there are 2 versions for running this exercise:</p>

<ul>
  <li>ROSNode Templates</li>
  <li>Web Templates(Current Release)</li>
</ul>

<p>The instructions for both of them are provided as follows.</p>

<h2 id="goal">Goal</h2>

<p>The objective of this practice is to implement the logic of a navigation algorithm for an autonomous vacuum cleaner by making use of the location of the robot. The robot is equipped with a map and knows it’s current location in it. The main objective will be to cover the largest area of ​​a house using the programmed algorithm.</p>

<p><img src="/RoboticsAcademy/assets/images/exercises/vacuum_cleaner_loc/vacuum_cleaner.png" width="100%" height="60%" /></p>

<figure class="half ">
  
    
      <img src="" alt="" />
    
  
    
      <img src="" alt="" />
    
  
  
    <figcaption>Vacuum cleaner
</figcaption>
  
</figure>

<h2 id="instructions-for-web-templates">Instructions for Web Templates</h2>
<p>This is the preferred way for running the exercise.</p>

<h3 id="installation">Installation</h3>
<ul>
  <li>
    <p>Clone the Robotics Academy repository on your local machine</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/JdeRobot/RoboticsAcademy
</code></pre></div>    </div>
  </li>
  <li>
    <p>Download <a href="https://docs.docker.com/get-docker/">Docker</a>. Windows users should choose WSL 2 backend Docker installation if possible, as it has better performance than Hyper-V.</p>
  </li>
  <li>
    <p>Pull the current distribution of Robotics Academy Docker Image</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker pull jderobot/robotics-academy:3.1.3
</code></pre></div>    </div>
  </li>
  <li>
    <p>In order to obtain optimal performance, Docker should be using multiple CPU cores. In case of Docker for Mac or Docker for Windows, the VM should be assigned a greater number of cores.</p>
  </li>
</ul>

<h3 id="enable-gpu-acceleration">Enable GPU Acceleration</h3>
<ul>
  <li>For Linux machines with NVIDIA GPUs, acceleration can be enabled by using NVIDIA proprietary drivers, installing  <a href="https://virtualgl.org/">VirtualGL</a> and executing the following docker run command:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">--rm</span> <span class="nt">-it</span> <span class="nt">--device</span> /dev/dri <span class="nt">-p</span> 8000:8000 <span class="nt">-p</span> 2303:2303 <span class="nt">-p</span> 1905:1905 <span class="nt">-p</span> 8765:8765 <span class="nt">-p</span> 6080:6080 <span class="nt">-p</span> 1108:1108 jderobot/robotics-academy:3.1.3 ./start-3.1.sh
</code></pre></div>    </div>
  </li>
  <li>For Windows machines, GPU acceleration to Docker is an experimental approach and can be implemented as per instructions given <a href="https://www.docker.com/blog/wsl-2-gpu-support-is-here/">here</a></li>
</ul>

<h3 id="how-to-perform-the-exercise">How to perform the exercise?</h3>
<ul>
  <li>
    <p>Start a new docker container of the image and keep it running in the background (<a href="#enable-gpu-acceleration">hardware accelerated version</a>)</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">--rm</span> <span class="nt">-it</span> <span class="nt">-p</span> 8000:8000 <span class="nt">-p</span> 2303:2303 <span class="nt">-p</span> 1905:1905 <span class="nt">-p</span> 8765:8765 <span class="nt">-p</span> 6080:6080 <span class="nt">-p</span> 1108:1108 jderobot/robotics-academy:3.1.3 ./start-3.1.sh
</code></pre></div>    </div>
  </li>
  <li>
    <p>On the local machine navigate to 127.0.0.1:8000/ in the browser and choose the desired exercise.</p>
  </li>
  <li>
    <p>Click the connect button and wait for some time until an alert appears with the message <code class="language-plaintext highlighter-rouge">Connection Established</code> and button displays connected.</p>
  </li>
  <li>
    <p>The exercise can be used after the alert.</p>
  </li>
</ul>

<p><strong>Where to insert the code?</strong></p>

<p>In the launched webpage, type your code in the text editor,</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">GUI</span> <span class="kn">import</span> <span class="n">GUI</span>
<span class="kn">from</span> <span class="nn">HAL</span> <span class="kn">import</span> <span class="n">HAL</span>
<span class="c1"># Enter sequential code!
</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="c1"># Enter iterative code!
</span></code></pre></div></div>

<h3 id="using-the-interface">Using the Interface</h3>

<ul>
  <li>
    <p><strong>Control Buttons</strong>: The control buttons enable the control of the interface. Play button sends the code written by User to the Robot. Stop button stops the code that is currently running on the Robot. Save button saves the code on the local machine. Load button loads the code from the local machine. Reset button resets the simulation(primarily, the position of the robot).</p>
  </li>
  <li>
    <p><strong>Frequency Slider</strong>: This slider adjusts the running frequency of the iterative part of the code(under the <code class="language-plaintext highlighter-rouge">while True:</code>). A smaller value implies the code runs less number of times. A higher value implies the code runs a large number of times. The Target Frequency is the one set on the Slider and Measured Frequency is the one measured by the computer(a frequency of execution the computer is able to maintain despite the commanded one). The student should adjust the Target Frequency according to the Measured Frequency.</p>
  </li>
  <li>
    <p><strong>Debug Level</strong>: This decides the debugging level of the code. A debug level of 1 implies no debugging at all. At this level, all the GUI functions written by the student are automatically removed when the student sends the code to the robot. A debug level greater than or equal to 2 enables all the GUI functions working properly.</p>
  </li>
  <li>
    <p><strong>Debugging Console</strong>: This shows the error messages related to the student’s code that is sent. The student can also use it to visualize the output of the print() function.</p>
  </li>
</ul>

<p><strong>Application Programming Interface</strong></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">from HAL import HAL</code> - to import the HAL(Hardware Abstraction Layer) library class. This class contains the functions that sends and receives information to and from the Hardware(Gazebo).</li>
  <li><code class="language-plaintext highlighter-rouge">from GUI import GUI</code> - to import the GUI(Graphical User Interface) library class. This class contains the functions used to view the debugging information, like image widgets.</li>
  <li><code class="language-plaintext highlighter-rouge">HAL.getPose3d().x</code> - to get the X coordinate of the robot</li>
  <li><code class="language-plaintext highlighter-rouge">HAL.getPose3d().y</code> - to get the Y coordinate of the robot</li>
  <li><code class="language-plaintext highlighter-rouge">HAL.getPose3d().yaw</code> - to get the orientation of the robot</li>
  <li><code class="language-plaintext highlighter-rouge">HAL.bumper.getBumperData().state</code> - To establish if the robot has crashed or not. Returns a 1 if the robot collides and a 0 if it has not crashed.</li>
  <li><code class="language-plaintext highlighter-rouge">HAL.bumper.getBumperData().bumper</code> - If the robot has crashed, it turns to 1 when the crash occurs at the center of the robot, 0 when it occurs at its left and 2 if the collision is at its right.</li>
  <li><code class="language-plaintext highlighter-rouge">HAL.laser.getLaserData()</code> - It allows to obtain the data of the laser sensor, which consists of 180 pairs of values ​​(0-180º, distance in millimeters).</li>
  <li><code class="language-plaintext highlighter-rouge">HAL.motors.sendV()</code> - to set the linear speed</li>
  <li><code class="language-plaintext highlighter-rouge">HAL.motors.sendW()</code> - to set the angular velocity</li>
</ul>

<h2 id="instructions-for-rosnode-templates">Instructions for ROSNode Templates</h2>

<h3 id="installation-1">Installation</h3>
<p>Install the <a href="https://jderobot.github.io/RoboticsAcademy/installation/#generic-infrastructure">General Infrastructure</a> of the JdeRobot Robotics Academy.</p>

<p>Enable Kobuki_msgs:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt-get <span class="nb">install </span>ros-melodic-kobuki-msgs
</code></pre></div></div>

<h3 id="how-to-run">How to run</h3>

<ol>
  <li>Execution watching the world:</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>roslaunch vacuum_cleaner_loc.launch
</code></pre></div></div>

<ol>
  <li>Execution of the practice and the user interface:</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python2 vacuum.py vacuum_conf.yml
</code></pre></div></div>

<ol>
  <li>Execution of the automatic evaluator:</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python2 referee.py vacuum_conf.yml
</code></pre></div></div>

<p>To simplify the closure of the environment, simply close the VacuumCleaner window (s). <em>Ctrl + C will give problems</em>.</p>

<h3 id="how-to-do-the-practice">How to do the practice</h3>

<p>To carry out the practice, you must edit the MyAlgorithms.py file and insert all the functionality in it.</p>

<h2 id="where-to-insert-the-code">Where to insert the code</h2>

<p><a href="MyAlgorithm.py#L81">MyAlgorithm.py</a></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

    <span class="c1"># Add your code here
</span>    <span class="k">print</span> <span class="s">"Runing"</span>

    <span class="c1">#EXAMPLE OF HOW TO SEND INFORMATION TO THE ROBOT ACTUATORS
</span>    <span class="c1">#HAL.motors.sendV(10)
</span>    <span class="c1">#HAL.motors.sendW(5)
</span></code></pre></div></div>

<h3 id="api">API</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">HAL.getPose3d().x</code> - to get the X coordinate of the robot</li>
  <li><code class="language-plaintext highlighter-rouge">HAL.getPose3d().y</code> - to get the Y coordinate of the robot</li>
  <li><code class="language-plaintext highlighter-rouge">HAL.getPose3d().yaw</code> - to get the orientation of the robot</li>
  <li><code class="language-plaintext highlighter-rouge">HAL.bumper.getBumperData().state</code> - to establish if the robot has crashed or not. Returns a 1 if the robot collides and a 0 if it has not crashed.</li>
  <li><code class="language-plaintext highlighter-rouge">HAL.bumper.getBumperData().bumper</code> - If the robot has crashed, it turns to 1 when the crash occurs at the center of the robot, 0 when it occurs at its left and 2 if the collision is at its right.</li>
  <li><code class="language-plaintext highlighter-rouge">HAL.getLaserData()</code> - It allows to obtain the data of the laser sensor, which consists of 180 pairs of values ​​(0-180º, distance in millimeters).</li>
  <li><code class="language-plaintext highlighter-rouge">HAL.motors.sendV()</code> - to set the linear speed</li>
  <li><code class="language-plaintext highlighter-rouge">HAL.motors.sendW()</code> - to set the angular velocity</li>
</ul>

<p>For this example, it is necessary to ensure that the vacuum cleaner covers the highest possible percentage of the house. The application of the automatic evaluator (referee) will measure the percentage traveled, and based on this percentage, will perform the qualification of the solution algorithm.</p>

<h3 id="types-conversion">Types conversion</h3>

<p><strong>Laser</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">laser_data</span> <span class="o">=</span> <span class="n">HAL</span><span class="p">.</span><span class="n">getLaserData</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">parse_laser_data</span><span class="p">(</span><span class="n">laser_data</span><span class="p">):</span>
    <span class="n">laser</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">180</span><span class="p">):</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">laser_data</span><span class="p">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">math</span><span class="p">.</span><span class="n">radians</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">laser</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">dist</span><span class="p">,</span> <span class="n">angle</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">laser</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">laser_vector</span><span class="p">(</span><span class="n">laser</span><span class="p">):</span>
    <span class="n">laser_vectorized</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">d</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="n">laser</span><span class="p">:</span>
        <span class="c1"># (4.2.1) laser into GUI reference system
</span>        <span class="n">x</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
        <span class="n">laser_vectorized</span> <span class="o">+=</span> <span class="p">[</span><span class="n">v</span><span class="p">]</span>

    <span class="n">laser_mean</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">laser_vectorized</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">laser_mean</span>
</code></pre></div></div>

<h2 id="demonstration-video">Demonstration video</h2>

<div class="embed-container">
  <iframe src="https://www.youtube.com/embed/I967nzeSSZg" width="700" height="480" frameborder="0" allowfullscreen="">
  </iframe>
</div>

<p><em>This solution is an illustration for the ROSNode Templates</em></p>

<div class="embed-container">
  <iframe src="https://www.youtube.com/embed/mT5PkgtDLDg" width="700" height="480" frameborder="0" allowfullscreen="">
  </iframe>
</div>

<p><em>This solution is an illustration for the Web Templates</em></p>

<p><br /></p>

<h2 id="theory">Theory</h2>
<p>As the problem may have multiple solutions, only the theory behind the reference solution has been covered.</p>

<h3 id="conversion-from-3d-to-2d">Conversion From 3D to 2D</h3>
<p><strong>Robot Localization</strong> is the process of determining, where robot is located with respect to it’s environment. Localization is a an important resource to us in solving this exercise. Localization can be accomplished in any way possible, be it Monte Carlo, Particle Filter, or even Offline Algorithms. Since, we have a map available to us, offline localization is the best way to move forward. Offline Localization will involve converting from a 3D environment scan to a 2D map. There are again numerous ways to do it, but the technique used in exercise is using <strong>transformation matrices</strong>.</p>

<h4 id="transformation-matrices">Transformation Matrices</h4>
<p>In simple terms, transformation is an invertible function that maps a set <em>X</em> to itself. Geometrically, it moves a point to some other location in some space. Algebraically, all the transformations can be mapped using matrix representation. In order to apply transformation on a point, we multiply the point with the specific transformation matrix to get the new location. Some important transformations are:</p>

<ul>
  <li><strong>Translation</strong></li>
</ul>

<p>Translation of Euclidean Space(2D or 3D world) moves every point by a fixed distance in the same direction</p>

<ul>
  <li><strong>Rotation</strong></li>
</ul>

<p>Rotation spins the object around a fixed point, known as center of rotation.</p>

<ul>
  <li><strong>Scaling</strong></li>
</ul>

<p>Scaling enlarges or diminishes objects, by a certain given scale factor.</p>

<ul>
  <li><strong>Shear</strong></li>
</ul>

<p>Shear rotates one axis so that the axes are no longer perpendicular.</p>

<p>In order to apply multiple transformations all at the same time, we use the concept of <strong>Transformation Matrix</strong> which enables us to multiply a single matrix for all the operations at once!</p>

<p><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn%3AANd9GcRj8-LHyAz5s62zEx9fnQg_KLZX08E_rbdfHQ52kQZwh3BvPqMl" alt="Transformation Matrix" /></p>

<p><em>Transformation Matrix</em></p>

<p>In our case we need to map a 3D Point in gazebo, to a 2D matrix map of our house. The equation used in the exercise was:</p>

<p><img src="http://localhost:4000/RoboticsAcademy/assets/images/exercises/vacuum_cleaner_loc/coord2pix.png" alt="Coordinate to Pixel" /></p>

<p><em>Coordinate to Pixel Conversion Equation</em></p>

<p>In order to carry out the inverse operation of 3D to 2D, we can simply multiply, the pixel vector with the inverse of the transformation matrix to get the gazebo vector. The inverse of the matrix exists because the <strong>mapping is invertible</strong> and we <strong>do not care about the z coordinate of the environment</strong>, implying that each point in gazebo corresponds to a single point in the map.</p>

<h3 id="coverage-and-decomposition">Coverage and Decomposition</h3>
<p>After the robot is localized in it’s environment, we can employ decomposition techniques in our algorithm, to deal with the actual coverage of the surroundings. There are lot of <a href="https://www.cs.cmu.edu/~motionplanning/lecture/Chap6-CellDecomp_howie.pdf">decomposition techniques</a> available for our use. The Decomposition Algorithm, decomposes the map into separate segments, which our robot can cover one by one. Decomposition can be directly related to <strong>Graph Theory</strong>, where the segments are taken as nodes and the edges connecting nodes depict that the adjacent segments share a common boundary. The robot can path plan to the nearest node and then start the sweeping again! Most of the details regarding decomposition would be implementation</p>

<p><img src="http://localhost:4000/RoboticsAcademy/assets/images/exercises/vacuum_cleaner_loc/adj_graph.png" alt="Decomposition and Graph Theory" /></p>

<p><em>Adjacency Graph</em></p>

<h3 id="travelling-between-segments">Travelling between segments</h3>
<p>Once, a certain segment has been swept. In order to reach the next segment(preferably nearest one) there are again a multitude of <a href="http://correll.cs.colorado.edu/?p=965">path planning algorithms</a>. The algorithm used in the reference solution is the <strong>Visibility Algorithm</strong>. As the name suggests, visibility of the target is the basic building block. So, let’s define visibility first off all!</p>

<p>If a straight line exists between two points, and the line does not pass over obstacles, the two points are said to be visible to each other. Mathematically speaking, the two points under consideration must satisfy a common equation.</p>

<p><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn%3AANd9GcRmpTMXyRw9cDm_0BWW6FTuBdXrBnozMP2uLGrwOQBev5hRwPK9" alt="Equation of a Line" /></p>

<p><em>Equation of a Line</em></p>

<p>Starting from the destination cell, the robot can map it’s path one cell at a time, while keeping visibility as a reference, until it reaches the current cell, the robot is present in. Once, the plan has been decided the robot can follow that path and reach it’s destination.</p>

<p><img src="http://localhost:4000/RoboticsAcademy/assets/images/exercises/vacuum_cleaner_loc/error.png" alt="Error of Obstacles" /></p>

<p><em>Visibility Error</em></p>

<p>But, sometimes due to close proximity to corner, the robot may collide with it. To avoid the occurrence of any such event, we may also consider dilation techniques, since the map used is a binary image. <strong>Erosion</strong> is a <strong>Morphology Function</strong> that erodes away the boundaries of foreground object(white is the object in foreground). Refer to this <a href="https://homepages.inf.ed.ac.uk/rbf/HIPR2/erode.htm">link</a> for more information on erosion.</p>

<p><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn%3AANd9GcTzn6m8Kkpb9OUy-mv70GpKRmsd3hySZBJZH8n5y-OLO4jBq9mW" alt="Morphological Operations" /></p>

<p><em>Morphological Operations</em></p>

<h2 id="hints">Hints</h2>
<p>Simple hints provided to help you solve the vacuum_cleaner_loc exercise. Please note that the <strong>full solution has not been provided.</strong> Also, the hints are more related to the reference solution, since multiple solutions are possible for this exercise.</p>

<h3 id="grid-representation">Grid Representation</h3>
<p>Due to the involvement of Localization in this exercise, we are given a map of the surroundings of the robot, which it needs to cover. The map is present in the directory path <code class="language-plaintext highlighter-rouge">resources/images/</code>. But since, we are using path planning and decomposition algorithms. These are very easy to implement on a grid like structure. Although any data structure, representing adjacency graph would suffice. See the <a href="#Illustrations">illustrations</a> for what happens without using any data structure(a brute force approach). To implement grids on images, we need to apply basic image processing, which can be accomplished easily using the <code class="language-plaintext highlighter-rouge">opencv</code> library.</p>

<p>The first step would be to apply erosion function on the map image. This is done in order to ensure some degree of distance between our robot and obstacle during runtime.</p>

<p>The second task is to come up with a <strong>transformation matrix</strong>, that would convert our 3d gazebo positions into 2d map representations. A degree of rotation has to applied on the Y axis and add a translation of 0.6 on the X axis and -1 on the Y axis can be used to get the origin of coordinates (0, 0) of the image in the upper left hand corner.</p>

<p>Once we get <strong>specific positions</strong> on our map. Using the dimensions of our vacuum cleaner, we can generate grid cells around those points. The size of vacuum cleaner can be taken as 16x16 pixel units. Take it as an exercise to calculate it on your own!</p>

<h3 id="obstacles-and-color-coding">Obstacles and Color Coding</h3>
<p>Taking the map as a grayscale image, we can apply <strong>color coding</strong> to the map as well. It is convenient to separate <strong>Obstacles</strong>, <strong>Virtual Obstacles</strong>, <strong>Return Points</strong> and <strong>Critical Points</strong></p>

<p>In the context of this exercise,</p>
<ul>
  <li><strong>Obstacles</strong>: The obstacles in our map that our robot cannot go over</li>
  <li><strong>Virtual Obstacles</strong>: The grid cell that our robot has covered.</li>
  <li><strong>Return Points</strong>: Starting points of the decomposed cells</li>
  <li><strong>Critical Points</strong>: The points where our robot has stuck between obstacles and virtual obstacles. It is from critical points, that our robot has to start moving towards the next return point.</li>
</ul>

<h3 id="checking-for-points">Checking for Points</h3>
<p>Defining different points simplifies the algorithm as well!</p>

<ul>
  <li>
    <p><strong>Return Points</strong>
Return Points can be checked while the robot is in zig-zag motion. Empty cells near the robot can be classified as return points. The list of Return Points has to be kept dynamic in order to insert and pop the points whenever required.</p>
  </li>
  <li>
    <p><strong>Critical Points</strong>
Critical Points can be classified whenever our robot is stuck around Obstacles or Virtual Obstacles and cannot move any further.</p>
  </li>
  <li>
    <p><strong>Checking for Arrival of Cell</strong>
Considering various offset errors in the real world(consider simulation to be real world as well!). Arrival of the robot in a particular cell should be considered within a margin of error, otherwise the robot may start oscillating, in the search of a cell on which it can never arrive.</p>
  </li>
  <li>
    <p><strong>Efficient Turning and Straight Motion</strong>
One trick to adjust the speed and direction of motion is to keep the next 3 cells of the robot which are in it’s direction of motion under consideration.</p>
  </li>
  <li><strong>All 3 cells are free</strong> Make the robot move at maximum speed</li>
  <li><strong>2 cells are free</strong>  Make the robot move at a fast speed</li>
  <li><strong>1 cell is free</strong> Along with small linear motion forward, start applying rotation as well</li>
  <li><strong>0 cells are free</strong> Stop the robot and apply only rotation</li>
</ul>

<p>As a final note, quite a lot of tips and tricks regarding implementation have been discussed in this page. This is a tough exercise, which may take <strong>quite a lot of time</strong> to solve. The main objective of the exercise is to cover a <strong>significant area of the house</strong>, without taking time into consideration.</p>

<h2 id="illustrations">Illustrations</h2>
<p><img src="http://localhost:4000/RoboticsAcademy/assets/images/exercises/vacuum_cleaner_loc/grid.gif" alt="Grid Based" /></p>

<p><em>Grid Based Approach</em></p>

<p><img src="http://localhost:4000/RoboticsAcademy/assets/images/exercises/vacuum_cleaner_loc/pid.gif" alt="PID Based" /></p>

<p><em>PID Based(without grid) Approach</em></p>

<h2 id="contributors">Contributors</h2>

<ul>
  <li>Contributors: <a href="https://github.com/vmartinezf">Vanessa Fernandez</a>, <a href="https://gsyc.urjc.es/jmplaza/">Jose María Cañas</a>, <a href="https://github.com/cawadall">Carlos Awadallah</a>, <a href="https://github.com/igarag">Nacho Arranz</a>.</li>
  <li>Maintained by <a href="https://github.com/SakshayMahna">Sakshay Mahna</a>.</li>
</ul>

<h2 id="references">References</h2>
<p>The major credit for this coverage algorithm goes to <a href="https://github.com/jmplaza">Jose María Cañas</a> and his student <a href="https://github.com/ilope236">Irene Lope</a>.</p>

<p><a href="https://onlinelibrary.wiley.com/doi/full/10.1002/047134608X.W8318">1</a>
<a href="https://en.wikipedia.org/wiki/Transformation_(function)">2</a>
<a href="https://www.cs.cmu.edu/~motionplanning/lecture/Chap6-CellDecomp_howie.pdf">3</a>
<a href="http://correll.cs.colorado.edu/?p=965">4</a>
<a href="https://homepages.inf.ed.ac.uk/rbf/HIPR2/dilate.htm">5</a>
<a href="https://gsyc.urjc.es/jmplaza/students/tfg-Robotics_Academy-irene_lope-2018.pdf">6</a></p>

<p>One of the best <a href="https://www.youtube.com/playlist?list=PLZHQObOWTQDPD3MizzM2xVFitgF8hE_ab">video series on Linear Algebra</a></p>

        
      </section>

      <footer class="page__meta">
        
        


        
      </footer>

      

      
    </div>

    
  </article>

  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://twitter.com/jderobot" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/JdeRobot/RoboticsAcademy" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
          <li><a href="https://www.youtube.com/channel/UCgmUgpircYAv_QhLQziHJOQ" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-youtube" aria-hidden="true"></i> Youtube</a></li>
        
      
    

   <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2021 JdeRobot. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>


      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>
  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML">
  </script>
  <script type="text/x-mathjax-config">
     MathJax.Hub.Config({
       extensions: ["tex2jax.js"],
       jax: ["input/TeX", "output/HTML-CSS"],
       tex2jax: {
         inlineMath: [ ['$','$'], ["\\(","\\)"] ],
         displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
         processEscapes: true
       },
       "HTML-CSS": { availableFonts: ["TeX"] }
     });
  </script>










  </body>
</html>
