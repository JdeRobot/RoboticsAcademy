<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.16.5 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Machine Vision - Robotics-Academy</title>
<meta name="description" content="A practical and fun way of learning Robotics and Computer Vision">



<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Robotics-Academy">
<meta property="og:title" content="Machine Vision">
<meta property="og:url" content="http://localhost:4000/exercises/IndustrialRobots/machine_vision">












  

  


<link rel="canonical" href="http://localhost:4000/exercises/IndustrialRobots/machine_vision">







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "JdeRobot",
      "url": "http://localhost:4000",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Robotics-Academy Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="icon" type="image/png" href="/assets/images/logo.png" sizes="16x16">
<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/logo.png" alt=""></a>
        
        <a class="site-title" href="/">
          Robotics-Academy
          <span class="site-subtitle">by JdeRobot organization</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/exercises/" >Exercises</a>
            </li><li class="masthead__menu-item">
              <a href="/installation/" >Installation</a>
            </li><li class="masthead__menu-item">
              <a href="https://forum.jderobot.org/c/english/roboticsacademy" >Forum</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name"></h3>
    
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      <li>
        
          
          

          <a href="/exercises/"><span class="nav__sub-title">Exercises</span></a>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/exercises/autonomous_cars_section" class="">Autonomous Driving</a></li>
          
            
            

            
            

            <li><a href="/exercises/mobile_robots_section" class="">Service Robots</a></li>
          
            
            

            
            

            <li><a href="/exercises/drones_section" class="">Drones</a></li>
          
            
            

            
            

            <li><a href="/exercises/computer_vision_section" class="">Computer Vision</a></li>
          
            
            

            
            

            <li><a href="/exercises/industrial_robots_section" class="">Industrial Robots</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Contribute</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/roadmap/" class="">Roadmap</a></li>
          
            
            

            
            

            <li><a href="/contribute/" class="">How to contribute</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>
    
  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Machine Vision">
    
    
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Machine Vision
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-cog"></i> TOC Machine Vision</h4></header>
              <ul class="toc__menu">
  <li><a href="#installation">Installation</a></li>
  <li><a href="#how-to-run-the-exercise">How to run the exercise</a></li>
  <li><a href="#how-should-i-solve-the-exercise">How should I solve the exercise</a></li>
  <li><a href="#api">API</a>
    <ul>
      <li><a href="#detect-object">Detect Object</a></li>
      <li><a href="#environment-information">Environment Information</a></li>
      <li><a href="#convert-pose-message">Convert Pose Message</a></li>
      <li><a href="#basic-robot-movement">Basic Robot Movement</a></li>
      <li><a href="#pick-and-place">Pick and Place</a></li>
    </ul>
  </li>
  <li><a href="#theory">Theory</a>
    <ul>
      <li><a href="#object-detection">Object Detection</a></li>
      <li><a href="#obstacle-detection-and-avoidance">Obstacle Detection and Avoidance</a></li>
    </ul>
  </li>
  <li><a href="#hints">Hints</a>
    <ul>
      <li><a href="#how-to-write-buildmap-function">How to write buildmap() function:</a></li>
      <li><a href="#how-to-write-get_object_position-function">How to write get_object_position() function:</a></li>
      <li><a href="#how-to-check-the-result-of-color-filter-and-shape-filter">How to check the result of color filter and shape filter?</a></li>
      <li><a href="#limitation-of-vacuum-gripper">Limitation of vacuum gripper</a></li>
      <li><a href="#ignorable-error-and-warning">Ignorable ERROR and WARNING</a></li>
      <li><a href="#object-and-target-lists">Object and Target lists:</a></li>
    </ul>
  </li>
  <li><a href="#demonstration-video-of-the-solution">Demonstration video of the solution</a></li>
</ul>
            </nav>
          </aside>
        
        <p>The goal of this exercise is to learn how to use vision to assist industrial robot by detecting known objects and unknown obstacles. You will need to complete pick and place task using a robot arm and vacuum gripper. Two kinect camera, one fixed to the world and another one fixed to the robot end effector, will be provided. The shape, size and color of the objects are known, but the pose of them and the situation of obstacles in surrounding environment need to be found using two cameras.</p>

<figure class="half ">
  
    
      <a href="/assets/images/exercises/machine_vision/world_secondexercise.png" title="Gazebo World">
        <img src="/assets/images/exercises/machine_vision/world_secondexercise.png" alt="Machine Vision" />
      </a>
    
  
    
      <a href="/assets/images/exercises/machine_vision/rviz_secondexercise.png" title="Rviz">
        <img src="/assets/images/exercises/machine_vision/rviz_secondexercise.png" alt="Machine Vision" />
      </a>
    
  
  
    <figcaption>Gallery.
</figcaption>
  
</figure>

<h2 id="installation">Installation</h2>
<ol>
  <li>Install the <a href="https://jderobot.github.io/RoboticsAcademy/installation/#generic-infrastructure">General Infrastructure</a> of the JdeRobot Robotics Academy.</li>
  <li>Install PCL and octomap related packages
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt-get <span class="nb">install </span>ros-melodic-octomap-ros
<span class="nb">sudo </span>apt-get <span class="nb">install </span>ros-melodic-octomap-msgs
<span class="nb">sudo </span>apt-get <span class="nb">install </span>ros-melodic-octomap-rviz-plugins
<span class="nb">sudo </span>apt <span class="nb">install </span>libpcl-dev
<span class="nb">sudo </span>apt-get <span class="nb">install </span>ros-melodic-perception-pcl
</code></pre></div>    </div>
  </li>
  <li>Install Industrial Robot package
If you have done this part in other Industrial Robots exercises, you can skip to next section.
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> <span class="nt">-p</span> catkin_ws/src
<span class="nb">cd </span>catkin_ws/src
</code></pre></div>    </div>
    <p>after pull request to the industrial robot repo</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/JdeRobot/IndustrialRobotics.git <span class="nt">-b</span> melodic_devel
<span class="nb">cd</span> ..
</code></pre></div>    </div>
    <p>Update ROS dependencies</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rosdep update
rosdep check <span class="nt">--from-paths</span> <span class="nb">.</span> <span class="nt">--ignore-src</span> <span class="nt">--rosdistro</span> melodic
rosdep <span class="nb">install</span> <span class="nt">--from-paths</span> <span class="nb">.</span> <span class="nt">--ignore-src</span> <span class="nt">--rosdistro</span> melodic <span class="nt">-y</span>
</code></pre></div>    </div>
    <p>Build workspace</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>catkin build
</code></pre></div>    </div>
    <p>Export environment variables</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s1">'source '</span><span class="nv">$PWD</span><span class="s1">'/devel/setup.bash'</span> <span class="o">&gt;&gt;</span> ~/.bashrc
<span class="nb">echo</span> <span class="s1">'export GAZEBO_MODEL_PATH=${GAZEBO_MODEL_PATH}:'</span><span class="nv">$PWD</span><span class="s1">'/src/IndustrialRobotics/assets/models'</span> <span class="o">&gt;&gt;</span> ~/.bashrc
<span class="nb">source</span> ~/.bashrc
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="how-to-run-the-exercise">How to run the exercise</h2>
<p>TO launch the exercise, open a terminal windows, navigate to <code class="language-plaintext highlighter-rouge">machine_vision</code> folder inside <code class="language-plaintext highlighter-rouge">exercises</code> folder and execute following command:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>roslaunch machine_vision.launch 
</code></pre></div></div>
<p>Three different windows will pop up:</p>
<ul>
  <li><strong>Gazebo simulator</strong>: A warehouse environment with a industrial robot(robot arm and gripper), multiple objects, two kinect cameras, a conveyor, a table and a box will be shown in Gazebo.</li>
  <li><strong>Rviz</strong>: Robot arm, cameras, model of objects, the pointcloud of fixed camera and the octomap build from the pointcloud of camera on robot will be shown in Rviz.</li>
  <li><strong>Industrial robot teleoperator</strong>: A GUI which provides following functionalities:
    <ul>
      <li>A Forward Kinematics teleoperator providing sliders to change the angle of each joint of the robot arm and the gripper. The limits of each joints are shown in the two sides of the slider. The true angle of the joints are shown in the text box beside the sliders.</li>
      <li>An Inverse Kinematics teleoperator allowing users to set the desired end effector pose.
        <ul>
          <li>Plan button can plan the trajectory to the desired pose</li>
          <li>Execute button can make the robot execute the planned trajectory</li>
          <li>Plan &amp; Execute button is the integration of last two buttons</li>
          <li>Stop button allows users to stop the robot</li>
          <li>Back to home button can make the robot move back to home pose</li>
        </ul>
      </li>
      <li>Two update button can update the value of current robot state</li>
      <li>Code Manager part
        <ul>
          <li>Four buttons to start, stop, pause and restart the main code you program</li>
          <li>One button to launch Rviz</li>
          <li>One button to Respawn all objects in Gazebo and Rviz</li>
          <li>An info box showing the status of the main code(“start” or “stop”)</li>
        </ul>
      </li>
      <li>Camera viewer
        <ul>
          <li>Two combo boxes to choose image topics to show in below image windows</li>
          <li>Two image windows to show chosen image topics</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<figure class=" ">
  
    
      <a href="/assets/images/exercises/machine_vision/newGUI_secondexercise.png" title="Robot Teleoperator">
        <img src="/assets/images/exercises/machine_vision/newGUI_secondexercise.png" alt="Robot Teleoperator" />
      </a>
    
  
  
    <figcaption>Robot teleoperator GUI
</figcaption>
  
</figure>

<p>Then open a new terminal window, navigate to <code class="language-plaintext highlighter-rouge">machine_vision</code> folder inside <code class="language-plaintext highlighter-rouge">exercises</code> folder and execute following command:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python MyAlgorithm.py
</code></pre></div></div>
<p>You can start running the algorithm with the start button when you see <code class="language-plaintext highlighter-rouge">You can start your algorithm with GUI</code> in the terminal.</p>

<h2 id="how-should-i-solve-the-exercise">How should I solve the exercise</h2>
<p>To solve the exercise, you must edit the MyAlgorithm.py file and insert control logic in myalgorithm() function. Before writing the main logic, you should implement build_map() function to detect obstacles in surrounding environments and get_object_position() function to detect the position of the objects.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">build_map</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1">############## Insert your code here ###############
</span>    <span class="bp">self</span><span class="p">.</span><span class="n">pick_place</span><span class="p">.</span><span class="n">send_message</span><span class="p">(</span><span class="s">"Building map"</span><span class="p">)</span>

    <span class="c1">####################################################
</span>
<span class="k">def</span> <span class="nf">get_object_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_name</span><span class="p">):</span>
    <span class="c1">############## Insert your code here ###############
</span>
    <span class="k">return</span> <span class="n">position</span>
    <span class="c1">####################################################
</span>
<span class="k">def</span> <span class="nf">myalgorithm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="c1">############## Insert your code here ###############
</span>    <span class="bp">self</span><span class="p">.</span><span class="n">build_map</span><span class="p">()</span>

    <span class="c1"># Move the robot back to home as a start
</span>    <span class="bp">self</span><span class="p">.</span><span class="n">pick_place</span><span class="p">.</span><span class="n">back_to_home</span><span class="p">()</span>
	
    <span class="c1"># insert following two lines where you want to pause or stop the algorithm 
</span>    <span class="c1"># with the stop button in GUI
</span>    <span class="k">while</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="p">.</span><span class="n">pauseevent</span><span class="p">.</span><span class="n">isSet</span><span class="p">())</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="p">.</span><span class="n">stopevent</span><span class="p">.</span><span class="n">isSet</span><span class="p">()):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">.</span><span class="n">stopevent</span><span class="p">.</span><span class="n">isSet</span><span class="p">():</span>
            <span class="k">return</span>

    <span class="c1">##### A brief example to pick and place object "green_cylinder" #####
</span>
    <span class="c1"># get object position and pick it up
</span>    <span class="c1"># parameters HEIGHT_OFFSET need to be tuned according to the object height
</span>    <span class="c1"># Height offset between robot base and conveyor is 0.2m
</span>    <span class="n">object_name</span> <span class="o">=</span> <span class="s">"green_cylinder"</span>

    <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_object_position</span><span class="p">(</span><span class="n">object_nam</span><span class="p">)</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">pick_place</span><span class="p">.</span><span class="n">pickup</span><span class="p">(</span><span class="n">object_name</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span>

    <span class="c1"># setup stop signal detector
</span>    <span class="k">while</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="p">.</span><span class="n">pauseevent</span><span class="p">.</span><span class="n">isSet</span><span class="p">())</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="p">.</span><span class="n">stopevent</span><span class="p">.</span><span class="n">isSet</span><span class="p">()):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">.</span><span class="n">stopevent</span><span class="p">.</span><span class="n">isSet</span><span class="p">():</span>
            <span class="k">return</span>

    <span class="c1"># choose target position and place the object
</span>    <span class="n">target_name</span> <span class="o">=</span> <span class="s">"target6"</span>
    <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">pick_place</span><span class="p">.</span><span class="n">get_target_position</span><span class="p">(</span><span class="n">target_name</span><span class="p">)</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">pick_place</span><span class="p">.</span><span class="n">place</span><span class="p">(</span><span class="n">object_name</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span>

    <span class="c1">####################################################
</span>

</code></pre></div></div>
<p>Multiple APIs can be used to implement your algorithm. They are provided in Pick_Place class, so you should always add “self.pick_place.” as a prefix to following introduced APIs in your algorithm.</p>

<h2 id="api">API</h2>
<h3 id="detect-object">Detect Object</h3>
<ul>
  <li><code class="language-plaintext highlighter-rouge">start_color_filter(color, rmax, rmin, gmax, gmin, bmax, bmin)</code> - Start color filter for given <code class="language-plaintext highlighter-rouge">color</code> with RGB range for this <code class="language-plaintext highlighter-rouge">color</code>. Two messages, <code class="language-plaintext highlighter-rouge">$(color)_filter</code>(pointcloud) and <code class="language-plaintext highlighter-rouge">$(color)_filtered_image</code>(RGB image), will be published until stopping with <code class="language-plaintext highlighter-rouge">stop_color_filter</code> function. Range of RGB value is [0, 255]</li>
  <li><code class="language-plaintext highlighter-rouge">stop_color_filter(color)</code> - Stop the color filter for given <code class="language-plaintext highlighter-rouge">color</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">start_shape_filter(color, shape, radius)</code> - Start the shape filter to detect one set of pointcloud that can represent the input <code class="language-plaintext highlighter-rouge">shape</code> and has a smaller than input <code class="language-plaintext highlighter-rouge">radius</code> size from color filtered pointcloud. If the filter can detect a possible shape from pointcloud, two messages, <code class="language-plaintext highlighter-rouge">$(color)_$(shape)</code>(pointcloud) and <code class="language-plaintext highlighter-rouge">$(color)_$(shape)_image</code>(depth image), will be published until stopping with <code class="language-plaintext highlighter-rouge">stop_shape_filter</code> function. A frame called <code class="language-plaintext highlighter-rouge">$(color)_$(shape)</code> will be added in tf tree. The origin of the frame is the center of predicted sphere center of a point in the center axis of predicted cylinder. The unit of radius is meter(m)</li>
  <li><code class="language-plaintext highlighter-rouge">stop_shape_filter(color, shape)</code> - Stop the shape filter.</li>
  <li><code class="language-plaintext highlighter-rouge">get_object_position(color, shape)</code> - If a frame named with <code class="language-plaintext highlighter-rouge">$(color)_$(shape)</code> exists in tf tree, output is the transformation from this frame to world frame. If not, output is None.</li>
</ul>

<h3 id="environment-information">Environment Information</h3>
<ul>
  <li><code class="language-plaintext highlighter-rouge">get_object_list()</code> - Return the name list of all objects.</li>
  <li><code class="language-plaintext highlighter-rouge">get_object_info(object_name)</code> - Return the height, width, length, shape, color of the object in order.</li>
  <li><code class="language-plaintext highlighter-rouge">get_target_list()</code> - Return the name list of all targets.</li>
  <li><code class="language-plaintext highlighter-rouge">get_target_position(target_name)</code> - Return the position of target where we are going to place the objects.</li>
</ul>

<h3 id="convert-pose-message">Convert Pose Message</h3>
<ul>
  <li><code class="language-plaintext highlighter-rouge">pose2msg(roll, pitch, yaw, x, y, z)</code> - Convert pose to Pose message. The unit of roll, pitch, yaw is radian.</li>
  <li><code class="language-plaintext highlighter-rouge">pose2msg_deg(roll, pitch, yaw, x, y, z)</code> - Convert pose to Pose message. The unit of roll, pitch, yaw is degree.</li>
  <li><code class="language-plaintext highlighter-rouge">msg2pose(pose)</code> - Convert Pose message to pose, return roll, pitch, yaw, x, y, z in order. The unit of roll, pitch, yaw is radian.</li>
  <li><code class="language-plaintext highlighter-rouge">msg2pose_deg(pose)</code> - Convert Pose message to pose, return roll, pitch, yaw, x, y, z in order. The unit of roll, pitch, yaw is degree.</li>
</ul>

<h3 id="basic-robot-movement">Basic Robot Movement</h3>
<ul>
  <li><code class="language-plaintext highlighter-rouge">move_pose_arm(pose_goal)</code> - Command the robot with Pose message to make its end effector frame move to the desired pose with inverse kinematics.</li>
  <li><code class="language-plaintext highlighter-rouge">move_joint_arm(joint_0,joint_1,joint_2,joint_3,joint_4,joint_5)</code> - Command the robot joints to move to desired joints value</li>
  <li><code class="language-plaintext highlighter-rouge">back_to_home()</code> - Command the robot arm and gripper to move back to the home pose.</li>
  <li><code class="language-plaintext highlighter-rouge">gripper_grasp()</code> - Turn on the vacuum gripper.</li>
  <li><code class="language-plaintext highlighter-rouge">gripper_release()</code> - Turn off the vacuum gripper.</li>
</ul>

<h3 id="pick-and-place">Pick and Place</h3>
<ul>
  <li><code class="language-plaintext highlighter-rouge">pickup(object_name, position[, distance])</code> - Command the industrial robot to pick up the object by moving the end effector to given position. Distance is the distance the robot arm will move in z axis before and after grasping objects.</li>
  <li><code class="language-plaintext highlighter-rouge">place(object_name, position[, distance])</code> - Command the industrial robot to place the object by moving the end effector to given position. Distance is the distance the robot arm will move in z axis before and after placing objects.</li>
</ul>

<h2 id="theory">Theory</h2>

<h3 id="object-detection">Object Detection</h3>
<p>In this exercise, object detectors are implemented based on <a href="https://pointclouds.org/">Point Cloud Library(PCL)</a>. It is an opensource point cloud processing library. There are multiple methods to detect the pose of known objects with vision. The method we choose here is fully based on pointcloud.</p>

<p>Assume that we only know the color, size and shape(sphere or cylinder) of the object we want to pick. Firstly, a color filter will filter out all points that are not inside chosen RGB range. Secondly, a shape segmentation will be done to find points that have the highest possibility to be a part of chosen shape and size. Some parameters about this possible shape will also be provided by the segmentation filter. With these information, we are able to find the position of sphere or cylinder.</p>

<h3 id="obstacle-detection-and-avoidance">Obstacle Detection and Avoidance</h3>
<p>In <code class="language-plaintext highlighter-rouge">Pick and Place</code> exercise, we have introduced that objects in planning scene will be considered as obstacles when doing motion planning to avoid collision. Obstacles are known and added into planning scene in that exercise, but what if we have no information about the surrounding environment? Obstacle detection will be necessary.</p>

<p>Obstacle detection can be done using many different sensors. What we use in this exercise is kinect camera which provides rgb image, depth image and pointcloud. Pointcloud from camera is what we finally use to build the obstacle map. Pointcloud contains the position of points and points can represent obstacles. If we merging these points and representing each of them with small cube, we will build a simplified map with obstacles in planning scene.</p>

<h2 id="hints">Hints</h2>

<h3 id="how-to-write-buildmap-function">How to write buildmap() function:</h3>
<p>The pointcloud from the camera fixed to the robot will be automatically monitored <code class="language-plaintext highlighter-rouge">occupancy_map_monitor/PointCloudOctomapUpdater</code> to update the planning scene, so what you have to do is move the robot around and make sure that the camera fixed to the robot can take image of all surrounding environment inside robot workspace.</p>

<h3 id="how-to-write-get_object_position-function">How to write get_object_position() function:</h3>
<ol>
  <li>Get the color, shape and size of the object.</li>
  <li>Choose RGB range for the color filter and start it. Check the color filter result with image viewer or Rviz and tune parameters to get better result.</li>
  <li>Choose the radius for the shape filter and start it. Check the shape filter result and tune parameters to get better result.</li>
  <li>Check the position output from <code class="language-plaintext highlighter-rouge">get_object_position</code> API.</li>
  <li>Return the position of detected object when getting a relatively stable object position.</li>
</ol>

<p><strong>Note:</strong> Please remember to stop the color filter and shape filter after getting the object position. If too many filters are running at the same time, you might not be able to get a stable result.</p>

<h3 id="how-to-check-the-result-of-color-filter-and-shape-filter">How to check the result of color filter and shape filter?</h3>
<p>Two image windows are provided in GUI. You can choose corresponding topic to check the result. All filtering process are done with pointcloud. The image is the projection of the pointcloud. From the image side, the expected result for color filter is that only the part with your chosen RGB value will be shown with original color in the image. All filtered out parts are black. The expected for shape filter is that only the points related to the detected shape will be shown with non-black color in the image. If nothing is detected, the whole image is black or you won’t see the image change from the previously chosen image. Here are the results(topic: “green_filtered_image” and “green_cylinder_image” of detecting green cylinder.</p>

<figure class="half ">
  
    
      <a href="/assets/images/exercises/machine_vision/green_filter_image.png" title="green_filter_image">
        <img src="/assets/images/exercises/machine_vision/green_filter_image.png" alt="green_filter_image" />
      </a>
    
  
    
      <a href="/assets/images/exercises/machine_vision/green_cylinder_image.png" title="green_cylinder_image">
        <img src="/assets/images/exercises/machine_vision/green_cylinder_image.png" alt="green_cylinder_image" />
      </a>
    
  
  
    <figcaption>green cylinder filter image
</figcaption>
  
</figure>

<p>To view 3D pointcloud, you need to launch Rviz and change the topic of Poindcloud to the topic you want to check. If nothing is detected, you will see nothing new in Rviz after choosing the topic. Here are the pointcloud results(topic: “yellow_filter” and “yellow_cylinder”) of detecting yellow cylinder.</p>

<figure class="half ">
  
    
      <a href="/assets/images/exercises/machine_vision/yellow_filter.png" title="yellow_filter">
        <img src="/assets/images/exercises/machine_vision/yellow_filter.png" alt="yellow_filter" />
      </a>
    
  
    
      <a href="/assets/images/exercises/machine_vision/yellow_cylinder_filter.png" title="yellow_cylinder_filter">
        <img src="/assets/images/exercises/machine_vision/yellow_cylinder_filter.png" alt="yellow_cylinder_filter" />
      </a>
    
  
  
    <figcaption>yellow cylinder filter pointcloud image
</figcaption>
  
</figure>

<h3 id="limitation-of-vacuum-gripper">Limitation of vacuum gripper</h3>
<p>Because the simulation of vacuum gripper is not perfect in this exercise, the robot sometimes cannot plan a path to place the object to target position or may drop the object on its way to target. Please take successfully building map and picking up desired objects as the sign of success.</p>

<h3 id="ignorable-error-and-warning">Ignorable ERROR and WARNING</h3>
<ul>
  <li><code class="language-plaintext highlighter-rouge">No p gain specified for pid.</code></li>
  <li><code class="language-plaintext highlighter-rouge">gazebo_ros_vacuum_gripper: already status is 'off'</code></li>
</ul>

<p>Following three errors can be ignored in the beginning, but if it keep spawning when you run your algorithm or move the robot with GUI, please relaunch the exercise.</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">The complete state of the robot is not yet known.  Missing gripper_joint, gripper_joint1, gripper_joint2, gripper_joint3, gripper_joint4, gripper_joint5, gripper_joint6, gripper_joint7, gripper_joint8</code></li>
  <li><code class="language-plaintext highlighter-rouge">Transform error: "vacuum_gripper5" passed to lookupTransform argument source_frame does not exist.</code></li>
  <li><code class="language-plaintext highlighter-rouge">Transform cache was not updated. Self-filtering may fail.</code></li>
</ul>

<h3 id="object-and-target-lists">Object and Target lists:</h3>
<p><strong>Object list:</strong></p>
<ul>
  <li>red_ball</li>
  <li>green_ball</li>
  <li>blue_ball</li>
  <li>yellow_ball</li>
  <li>red_cylinder</li>
  <li>green_cylinder</li>
  <li>blue_cylinder</li>
  <li>yellow_cylinder</li>
</ul>

<p><strong>Target list:</strong> target_ID, ID are integers from 1 to 16</p>

<h2 id="demonstration-video-of-the-solution">Demonstration video of the solution</h2>

<div class="embed-container">
  <iframe src="https://www.youtube.com/embed/LHq4ZA2lGxQ" width="700" height="480" frameborder="0" allowfullscreen="">
  </iframe>
</div>

        
      </section>

      <footer class="page__meta">
        
        


        
      </footer>

      

      
    </div>

    
  </article>

  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://twitter.com/jderobot" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/JdeRobot/RoboticsAcademy" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
          <li><a href="https://www.youtube.com/channel/UCgmUgpircYAv_QhLQziHJOQ" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-youtube" aria-hidden="true"></i> Youtube</a></li>
        
      
    

   <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2021 JdeRobot. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>


      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>
  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML">
  </script>
  <script type="text/x-mathjax-config">
     MathJax.Hub.Config({
       extensions: ["tex2jax.js"],
       jax: ["input/TeX", "output/HTML-CSS"],
       tex2jax: {
         inlineMath: [ ['$','$'], ["\\(","\\)"] ],
         displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
         processEscapes: true
       },
       "HTML-CSS": { availableFonts: ["TeX"] }
     });
  </script>










  </body>
</html>
