<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.16.5 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Single Robot: Amazon Warehouse - Robotics-Academy</title>
<meta name="description" content="A practical and fun way of learning Robotics and Computer Vision">



<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Robotics-Academy">
<meta property="og:title" content="Single Robot: Amazon Warehouse">
<meta property="og:url" content="http://localhost:4000/exercises/MobileRobots/single_robot_amazon_warehouse/">












  

  


<link rel="canonical" href="http://localhost:4000/exercises/MobileRobots/single_robot_amazon_warehouse/">







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "JdeRobot",
      "url": "http://localhost:4000",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Robotics-Academy Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="icon" type="image/png" href="/assets/images/logo.png" sizes="16x16">
<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/logo.png" alt=""></a>
        
        <a class="site-title" href="/">
          Robotics-Academy
          <span class="site-subtitle">by JdeRobot organization</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/exercises/" >Exercises</a>
            </li><li class="masthead__menu-item">
              <a href="/installation/" >Installation</a>
            </li><li class="masthead__menu-item">
              <a href="https://forum.jderobot.org/c/english/roboticsacademy" >Forum</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name"></h3>
    
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      <li>
        
          
          

          <a href="/exercises/"><span class="nav__sub-title">Exercises</span></a>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/exercises/autonomous_cars_section" class="">Autonomous Driving</a></li>
          
            
            

            
            

            <li><a href="/exercises/mobile_robots_section" class="">Service Robots</a></li>
          
            
            

            
            

            <li><a href="/exercises/drones_section" class="">Drones</a></li>
          
            
            

            
            

            <li><a href="/exercises/computer_vision_section" class="">Computer Vision</a></li>
          
            
            

            
            

            <li><a href="/exercises/industrial_robots_section" class="">Industrial Robots</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Contribute</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/roadmap/" class="">Roadmap</a></li>
          
            
            

            
            

            <li><a href="/contribute/" class="">How to contribute</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>
    
  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Single Robot: Amazon Warehouse">
    
    
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Single Robot: Amazon Warehouse
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-cog"></i> Single Robot: Amazon Warehouse</h4></header>
              <ul class="toc__menu">
  <li><a href="#background">Background</a></li>
  <li><a href="#goals">Goals</a></li>
  <li><a href="#setup-and-installation">Setup and installation</a>
    <ul>
      <li><a href="#docker">Docker</a></li>
      <li><a href="#ros2-foxy-workspace">ROS2 Foxy Workspace</a></li>
    </ul>
  </li>
  <li><a href="#walkthrough">Walkthrough</a></li>
  <li><a href="#important-concepts">Important concepts</a>
    <ul>
      <li><a href="#planning-and-controlling">Planning and Controlling</a></li>
      <li><a href="#ros2">ROS2</a></li>
      <li><a href="#navigation-2">Navigation 2</a></li>
      <li><a href="#ros-actions">ROS Actions</a></li>
      <li><a href="#behaviour-trees">Behaviour Trees</a></li>
      <li><a href="#understanding-package-structure">Understanding package structure</a></li>
    </ul>
  </li>
  <li><a href="#hints">Hints</a></li>
  <li><a href="#cheatsheet">Cheatsheet</a></li>
  <li><a href="#contributors">Contributors</a></li>
  <li><a href="#references">References</a></li>
</ul>
            </nav>
          </aside>
        
        <p>This exercise tries to recreate an automated warehouse environment (just like amazon warehouse) and introduces you to many concepts regarding navigation of robots in ROS2. By the end of this exercise, you will be able to understand and leverage Navigation 2 stack for Amazon Robot to perform a pick and place autonomously.</p>

<figure class="half ">
  
    
      <a href="/assets/images/exercises/single_robot_amazon_warehouse/amazon_warehouse1.png" title="Warehouse">
        <img src="/assets/images/exercises/single_robot_amazon_warehouse/amazon_warehouse1.png" alt="Warehouse" />
      </a>
    
  
    
      <a href="/assets/images/exercises/single_robot_amazon_warehouse/amazon_warehouse2.png" title="MobileRobot">
        <img src="/assets/images/exercises/single_robot_amazon_warehouse/amazon_warehouse2.png" alt="MobileRobot" />
      </a>
    
  
  
    <figcaption>Gallery
</figcaption>
  
</figure>

<h2 id="background">Background</h2>

<p>Automated warehouses play an important role in modern Industry 4.0 based factories. Retailers such as Amazon use it to move around pallets of shipments, manufactures such as Bosch use it to manage the inventory and so on.</p>

<p>In this exercise, we are using quite a faithful recreation of one such warehouse (<a href="https://github.com/aws-robotics/aws-robomaker-small-warehouse-world">It is actually from Amazon</a>!) and a custom made robot with loading - unloading lift.</p>

<h2 id="goals">Goals</h2>

<p>The end goal of this exercise is to have our robot autonomously drive around and perform series of load-unload tasks to move pallets around. But before trying to implement this, you will have to understand ROS2 architecture, how navigation 2 stack works, what are behaviour trees (BT) and ROS action client.</p>

<p>Overall, this exercise might provide you with a starting point to get into development using ROS 2 and navigation 2. Additionally, you can also use the exercise for researching in different navigation components such as path planners and costmaps.</p>

<p>Following are some of the mandatory (!) , optional (/) and feature(*) goals. Feature goals require adding some functionality in the existing framework, which you will also have to implement by yourself.</p>

<ol>
  <li>(!) Driving robot around autonomously with a pre-determined drive plan or waypoints.</li>
  <li>(!) Correctly loading and unloading pallets at the waypoints and successfully moving them to another location</li>
  <li>(!) Using ROS2 action client to publish a feedback of current waypoint.</li>
  <li>(!) Modifying behaviour trees (BT) to implement <em>“Wait”</em> behaviour.</li>
  <li>(/) Using different path planner and observing its effects</li>
  <li>(/) Using different costmap</li>
  <li>(/) Modifying behaviour trees to implement complex behaviours such as No-Go Zone.</li>
  <li>(*) Implementing new BT plugins for approach behaviour ( When close to the pallet).</li>
  <li>(*) Implementing charging concept by creating new costmap plugin.</li>
  <li>(*) Implementing different path planners and comparing them in a warehouse environment.</li>
</ol>

<p>and so on ..</p>

<h2 id="setup-and-installation">Setup and installation</h2>

<h3 id="docker">Docker</h3>

<p>For easy onboarding, docker images are provided. You can either clone from JdeRobot’s docker hub or build it from the directory itself.</p>

<p>Pull docker image</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker pull jderobot/robotics-academy-ros2:amazon-warehouse-single-robot
</code></pre></div></div>

<p>Before deploying, elevate docker for xhost docker access. Keep in mind that this is a bit insecure way and don’t forget to de-elevate the access once you are done.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>xhost +<span class="s2">"local:docker@"</span>
</code></pre></div></div>

<p>To start and deploy the containers in systems having NVIDIA drivers, run following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>docker run <span class="nt">-it</span>  <span class="nt">-e</span> <span class="nv">DISPLAY</span><span class="o">=</span><span class="nv">$DISPLAY</span> <span class="se">\</span>
                 <span class="nt">-e</span> <span class="nv">GAZEBO_MODEL_PATH</span><span class="o">=</span>/opt/warehouse_ws/src/amazon_robot_gazebo/models:/opt/warehouse_ws/src/aws-robomaker-small-warehouse-world/models <span class="se">\</span>
                 <span class="nt">-v</span> <span class="nv">$XSOCK</span>:<span class="nv">$XSOCK</span> <span class="se">\</span>
                 <span class="nt">-v</span> <span class="nv">$HOME</span>/.Xauthority:/root/.Xauthority <span class="se">\</span>
                 <span class="nt">--privileged</span>  <span class="nt">--net</span><span class="o">=</span>host <span class="nt">--gpus</span> all <span class="se">\</span>
                 jderobot/robotics-academy-ros2:amazon-warehouse-single-robot /bin/bash
</code></pre></div></div>

<p>To start and deploy containers on Intel drivers, run following:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>docker run <span class="nt">-it</span> <span class="se">\ </span>
                <span class="nt">--env</span><span class="o">=</span><span class="s2">"DISPLAY"</span> <span class="se">\</span>
                <span class="nt">--env</span><span class="o">=</span><span class="s2">"QT_X11_NO_MITSHM=1"</span> <span class="se">\</span>
                <span class="nt">--env</span><span class="o">=</span><span class="s2">"GAZEBO_MODEL_PATH=/opt/warehouse_ws/src/amazon_robot_gazebo/models:/opt/warehouse_ws/src/aws-robomaker-small-warehouse-world/models"</span><span class="se">\</span>
                <span class="nt">--volume</span><span class="o">=</span><span class="s2">"/tmp/.X11-unix:/tmp/.X11-unix:rw"</span> <span class="se">\</span>
	              jderobot/robotics-academy-ros2:amazon-warehouse-single-robot /bin/bash
</code></pre></div></div>

<p>Finally, run following <strong>inside</strong> the container to start our world</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">.</span> ./install/setup.sh
ros2 launch amazon_robot_bringup amazon_robot_in_aws_world.py
</code></pre></div></div>

<hr />

<p>If you want to change some of the core components, you can clone the repo, change your scripts and deploy your container from the repository using docker-compose from the root amazon-robot repo.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>docker-compose up <span class="nt">--build</span> 
</code></pre></div></div>

<h3 id="ros2-foxy-workspace">ROS2 Foxy Workspace</h3>

<p>Follow <a href="https://index.ros.org/doc/ros2/Installation/Foxy/">ROS2 Foxy installation</a> according to the official guide.</p>

<p>Install navigation 2 by <a href="https://navigation.ros.org/build_instructions/index.html">following the documentation</a>.</p>

<p>Clone following repo into your workspace (or create a new one). Source navigation workspace <strong>before</strong> you build this one in order for colcon to find packages locations.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/JdeRobot/CustomRobots.git
git checkout foxy-devel
</code></pre></div></div>

<p>Install rosdeps</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>amazon_robot
rosdep <span class="nb">install</span> <span class="nt">--from-paths</span> src <span class="nt">--ignore-src</span> <span class="nt">-r</span> <span class="nt">-y</span>
</code></pre></div></div>

<p>Compile, build and run the bringup launch</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>colcon build <span class="nt">--symlink-install</span>
<span class="nb">.</span> ./install/setup.sh
ros2 launch amazon_robot_bringup amazon_robot_in_aws_world.py
</code></pre></div></div>

<h2 id="walkthrough">Walkthrough</h2>

<figure class="half ">
  
    
      <a href="/assets/images/exercises/single_robot_amazon_warehouse/setting_pose1.png" title="Setting Pose 1">
        <img src="/assets/images/exercises/single_robot_amazon_warehouse/setting_pose1.png" alt="Setting Pose 1" />
      </a>
    
  
    
      <a href="/assets/images/exercises/single_robot_amazon_warehouse/setting_pose2.png" title="Setting Pose 2">
        <img src="/assets/images/exercises/single_robot_amazon_warehouse/setting_pose2.png" alt="Setting Pose 2" />
      </a>
    
  
  
    <figcaption>Theory
</figcaption>
  
</figure>

<p>When you launch the docker via docker-compose, it fetches everything needed and runs <code class="language-plaintext highlighter-rouge">amazon_robot_in_aws_world.py</code> launch file (<code class="language-plaintext highlighter-rouge">amazon_robot_bringup/bringup/launch</code>).  To make it easier, everything is organised from our bringup directory. This file, launches other files and nodes and so on. In the end you will see the familiar RViz and Gazebo Windows. It will take a while to load, have some patience 😅. Finally, once everything is ready, localize our robot in approximate position of the map.</p>

<p>Click on <code class="language-plaintext highlighter-rouge">2D Pose estimate</code> button and estimate our pose on the map. Approximate is fine. This will initialize our nav stack. Then, click on <code class="language-plaintext highlighter-rouge">waypoint mode</code> and estimate the pose again. Usually, this initializes the waypoint tool but as we have overloaded this nav button, it will initialize our plugin.  Then, set your pickup and dropoff points using <code class="language-plaintext highlighter-rouge">Navigation Goal</code> button and click on <code class="language-plaintext highlighter-rouge">Start Navigation</code></p>

<p><img src="/assets/images/exercises/single_robot_amazon_warehouse/setting_pose.gif" alt="Setting Pose" /></p>

<p>The robot will start moving. When it reaches our first goal point, it will actuate the lift joint to <code class="language-plaintext highlighter-rouge">Load</code> position- making the pallet loaded on the robot. It will go on to the next point and unload the pallet. This actuation, by default, will happen alternately. For example first load, then unload then again load and so on.  The robot will also carry the pallet with it as it moves.</p>

<p>Our robot is a modification of turtlebot3, and it was not designed to lift heavy objects. So you might encounter some imperfections in the way robot holds the pallet. If it fails, just restart the exercise and try giving it a different pose.</p>

<div class="embed-container">
  <iframe src="https://www.youtube.com/embed/xmHCwA0NgjM" width="700" height="480" frameborder="0" allowfullscreen="">
  </iframe>
</div>

<p>Your task now is to implement your own action client which can give goals to our action server.</p>

<h2 id="important-concepts">Important concepts</h2>

<p>To get started, you must get understand some theoretical concepts as well as the software stack. It is also very essential to understand <a href="https://navigation.ros.org/concepts/index.html">Navigation 2 stack concepts</a> to solve the exercise.</p>

<h3 id="planning-and-controlling">Planning and Controlling</h3>

<p><strong>Path planning</strong></p>

<p>There are numerous algorithms which deal with path finding. A* [1] is an optimal single robot path finding algorithm with a heuristic component, which is now used widely as a go-to path planner. Theta<em>[2] algorithm works by connecting discrete grid points on the map through a continuous line, not limited to graph edges. Another option is Rapidly Exploring Trees (RRT) [3] and RRT</em>[4]. Each of these algorithms also possesses different shortcomings with respect to scalability and speed.</p>

<p>In current navigation stack, we have option of using DWB planner or A* as our default path planner.</p>

<p><strong>Behaviour Planning</strong></p>

<p>Co-operations of the robots with each other can lead to interesting behaviour patterns and can lead to an increase in efficiency. For example, robots can split themselves in such a way that they can explore and find targets quicker.[5] [6]</p>

<p>In Navigation 2 these behaviours are created using <a href="https://en.wikipedia.org/wiki/Behavior_tree_(artificial_intelligence,_robotics_and_control)">behaviour trees</a>.</p>

<p><strong>Motion Planning</strong></p>

<p>This essentially corresponds to planning the exact input given to the motors in order to drive in a certain direction. Jderobot Academy already has <a href="https://jderobot.github.io/RoboticsAcademy/exercises/AutonomousCars/follow_line/">an exercise dedicated for this</a> which I’d definitely recommend the readers to check it out.</p>

<h3 id="ros2">ROS2</h3>

<p>This is a natural successor of Robot Operating System (ROS1), redesigned from scratch. ROS2 has shiny new features such as multithreading and realtime support.  It is <a href="https://index.ros.org/doc/ros2/">very well documented</a> and provides an easy entrypoint for a newcomers and old chaps from ROS1 alike. It is best to start with some <a href="https://index.ros.org/doc/ros2/Tutorials/#tutorials">basic tutorials</a> and get familiar with the concepts as you progress.</p>

<p>If you already have some experience with ROS1, I’d suggest to read these 2 excellent articles depicting <a href="https://design.ros2.org/articles/changes.html">changes from ROS1 to ROS2</a> by <em>Dirk Thomas</em> and <a href="https://industrial-training-master.readthedocs.io/en/melodic/_source/session7/ROS1-to-ROS2-porting.html">migration from ROS1 to ROS2</a> by <em>ROS industrial.</em></p>

<h3 id="navigation-2">Navigation 2</h3>

<p>Navigation2 or nav2 is the successor of the navigation stack in ROS1 for ROS2 and it is build completely from ground up, with many added features. Navigation2 also uses Behavior trees instead of the FSMs used in <code class="language-plaintext highlighter-rouge">move_base</code> and they are much more intuitive and modern way of handling navigation tasks. <code class="language-plaintext highlighter-rouge">move_base</code> itself is no longer used and instead many different parts combine make the core of navigation 2.</p>

<p>Navigation2 already has an <a href="https://navigation.ros.org/">up to date and extensive documentation</a> and a <a href="https://arxiv.org/abs/2003.00368">really nicely written paper</a>, which you should definitely read. But if you are a video person, I’d advise watching the minutes of ROS working group meeting to get it started quickly.</p>

<div class="embed-container">
  <iframe src="https://www.youtube.com/embed/-MzsEykCXoU" width="700" height="480" frameborder="0" allowfullscreen="">
  </iframe>
</div>

<p>Two components of navigation are planning a path and executing the motion. Traditionally, these were handled using respective planning and control servers in ROS1. They make information such as costmaps and parameters available to all the other ROS nodes. In ROS2, they are represented as plugins.</p>

<h3 id="ros-actions">ROS Actions</h3>

<p>Consider this scenario: You want to buy something, say a toothbrush, online. You find one which you like and now you want to order it. But you find out that the system wants you to go on the warehouse’s site and tell the admins that you need this particular item, then tell the packing station to pack it, then order delivery services to pick this package and then drop it at your doorstep, all by yourself. You will think that this is crazy as all you want is the package delivered and you really don’t care about the steps in between. Sure, you would <em>like</em> to have updates regarding the shipment, but the whole purpose of ordering online is not to deal with the stuff in-between. Well, this is exactly what ROS action does.</p>

<p><img src="/assets/images/exercises/single_robot_amazon_warehouse/ros2_actions.png" alt="ROS2 Actions" /></p>

<p>Credits: <a href="https://index.ros.org/doc/ros2/Tutorials/Understanding-ROS2-Actions/">Actions Tutorial ROS2</a></p>

<p>ROS actions provide an interface which abstracts long, complex task from the node. You can program an <em>“Action Server”</em> to accept requests of a task and return the result of the request once it is completed to the <em>“Action Client”</em>. Meanwhile, you can also get updates regarding your request. Action client can also cancel or update your goal for the task.</p>

<p>In Navigation 2, action servers are used to communicate with the highest level BT navigator through a <code class="language-plaintext highlighter-rouge">NavigateToPose</code> action message. They are also used for the BT navigator to communicate with the subsequent smaller action servers to compute plans, control efforts, and recoveries. Each will have their own unique <code class="language-plaintext highlighter-rouge">.action</code> type in <code class="language-plaintext highlighter-rouge">nav2_msgs</code> package for interacting with the servers. Our own custom node also provides it’s action server you will have to use in order to complete the exercise.</p>

<p>For understanding it better, I’d definitely recommend the reader to have a look on the <a href="http://design.ros2.org/articles/actions.html">ROS2 action design</a> and <a href="https://index.ros.org/doc/ros2/Tutorials/Understanding-ROS2-Actions/">ROS2 action tutorial</a>.</p>

<h3 id="behaviour-trees">Behaviour Trees</h3>

<p>Navigation2 documentation explains behaviour trees the best, so I am just going to link it here. But in essence, it splits the whole operation of a robot into smaller behaviours in a specific structure governed by rules. For example, if we want to have a robot to play football, we can split it in different primitives such as run to the ball, dribble, shoot and these states are further divided into sub primitives. How we can change from one behaviour to another is also dependant on rules and what conditions are satisfied.</p>

<p>Navigation 2 uses <a href="https://www.behaviortree.dev/">BehaviorTree</a> CPP V3 as the behaviour tree library and we can use the trees created for navigation2 as subtrees of other trees. We create node plugins which can be constructed into a tree, inside the <code class="language-plaintext highlighter-rouge">BT Navigator</code>. The node plugins are loaded into the BT and when the XML file of the tree is parsed, the registered names are associated.</p>

<p>In our case, we have created our custom behaviour tree node: <code class="language-plaintext highlighter-rouge">LoadPallet</code> which loads and unloads the pallet. In addition, we are also navigating  to new waypoints based on our custom behaviour tree.</p>

<h3 id="understanding-package-structure">Understanding package structure</h3>

<p>Although not necessary, if you want to add new features, it is beneficial to understand the folder structure and scripts. This is especially required when creating new behaviour tree plugins. If so, you can read <a href="https://theroboticsclub.github.io/colab-gsoc2020-Shreyas_Gokhale/jde-multibot#single-amazon-robot-package">this blog post explaining packages</a>.</p>

<h2 id="hints">Hints</h2>

<p>When you give a goal in RViz it is recognized by the corresponding RViz plugin. An action server spawns behind the scenes and performs the same work that your action client is supposed to do. You can leverage other actions by writing multiple action clients in the same script.</p>

<h2 id="cheatsheet">Cheatsheet</h2>

<p>You can consider following parameters while making the plan:</p>
<ol>
  <li>Distance from robot to the nearest pallet</li>
  <li>Distance of pallet from the storage location</li>
  <li>Current waypoints, remaining waypoints ..</li>
  <li>State of the lift joint</li>
</ol>

<p>To access these parameters, you will have to use various ros concepts such as subscribing to a topic or creating an action client.</p>

<p>For example, to get a path between current position of the robot and another position (in our case, a pallet at positon (x,y,z)), you can call the action server <code class="language-plaintext highlighter-rouge">/compute_path_to_pose</code> which will return you an array of points of the path.</p>

<p>You can also get the current robot position using robot odometry topic (<code class="language-plaintext highlighter-rouge">/odom</code>), which you can use for different calculations. You can also experiment with different path planners, costmaps, behaviour trees and planners.</p>

<p>Also consider what responses you can get from Navigation Stack, for example: when a robot undergoes recovery or if navigation has failed.</p>

<p>While testing, if you want to manually lift the lift platform, you can do so by issuing a service call as follows:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ros2 service call /apply_joint_effort gazebo_msgs/srv/ApplyJointEffort <span class="s1">'{joint_name: "lift_joint", effort: -2.0, start_time: {sec: 0, nanosec: 0}, duration: {sec: 2000, nanosec: 0} }'</span>
</code></pre></div></div>

<p>Following topics might be helpful:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/amcl_pose
/scan
/imu
/odom
/initialpose
/cmd_vel
/map
</code></pre></div></div>

<p>Following action servers might be useful:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/FollowTargets
/backup
/compute_path_to_pose
/follow_path
/navigate_to_pose
/spin
/wait
</code></pre></div></div>

<p><strong><em>Have fun!</em></strong></p>

<h2 id="contributors">Contributors</h2>

<p><a href="https://theroboticsclub.github.io/colab-gsoc2020-Shreyas_Gokhale/about/">Shreyas Gokhale</a></p>

<h2 id="references">References</h2>

<p>[1]	“astarNilsson.pdf.” Accessed: Mar. 26, 2020. [Online]. Available: https://www.cs.auckland.ac.nz/courses/compsci709s2c/resources/Mike.d/astarNilsson.pdf.</p>

<p>[2]	K. Daniel, A. Nash, S. Koenig, and A. Felner, “Theta<em>: Any-Angle Path Planning on Grids,” *J. Artif. Intell. Res.</em>, vol. 39, pp. 533–579, Oct. 2010, doi: 10.1613/jair.2994.</p>

<p>[3]	“Lav98c.pdf.” Accessed: Mar. 26, 2020. [Online]. Available: http://msl.cs.illinois.edu/~lavalle/papers/Lav98c.pdf.</p>

<p>[4]	V. R. Desaraju and J. P. How, “Decentralized path planning for multi-agent teams in complex environments using rapidly-exploring random trees,” in <em>2011 IEEE International Conference on Robotics and Automation</em> , May 2011, pp. 4956–4961, doi: 10.1109/ICRA.2011.5980392.</p>

<p>[5]	“Coordination strategies for multi-robot exploration and mapping - Carlos Nieto-Granda, John G. Rogers, Henrik I. Christensen, 2014.” https://journals.sagepub.com/doi/abs/10.1177/0278364913515309 (accessed Mar. 28, 2020).</p>

<p>[6]	“explore_multirobot - ROS Wiki.” http://wiki.ros.org/explore_multirobot (accessed Mar. 28, 2020).</p>

        
      </section>

      <footer class="page__meta">
        
        


        
      </footer>

      

      
    </div>

    
  </article>

  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://twitter.com/jderobot" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/JdeRobot/RoboticsAcademy" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
          <li><a href="https://www.youtube.com/channel/UCgmUgpircYAv_QhLQziHJOQ" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-youtube" aria-hidden="true"></i> Youtube</a></li>
        
      
    

   <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2021 JdeRobot. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>


      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>
  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML">
  </script>
  <script type="text/x-mathjax-config">
     MathJax.Hub.Config({
       extensions: ["tex2jax.js"],
       jax: ["input/TeX", "output/HTML-CSS"],
       tex2jax: {
         inlineMath: [ ['$','$'], ["\\(","\\)"] ],
         displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
         processEscapes: true
       },
       "HTML-CSS": { availableFonts: ["TeX"] }
     });
  </script>










  </body>
</html>
